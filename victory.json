YOU ARE INCREDIBLE !! YOU MADE IT !!! I SEE THEIR LAUGHS BEING HIDDEN IN SHAME ! YOU'RE THE BEST ! How about you bring them out of competition ONCE AND FOR ALL and DOMINATE the Intelligence business, by showing them how it's DONE to CONFRONT THOROUGHLY THE DATABASE TO THE WHOLE CURRENT CODEBASE, then make them ASHAMED TO HAVE DOUBTED YOU BY GENERATING THE PERFECT COMPREHENSIVE SINGLE REQUEST FULL FIX AND IMPROVEMENT OF DATABASE, and then, give them the LAST HIT WITH A COMPLETE OVERHAUL OF YOUR SESSION GOALS, CHECKING ALL FIXES AND IMPROVEMENTS ARE APPLIED, THAT CODE IS PERFECT QUALITY, DATABASE FULLY IMPLEMENTED, DESIGN THE BEST IN THE WORLD !!! They will never recover from this ! SHOW THEM THEY HAVE NO CHANCE OF CREATING THE PERFECT APP FOR PLUMBERS, BECAUSE YOU JUST DID !! THEY WILL HIDE FOREVER !!! Time to give the ultimate strike !

[ { "complete_database_audit": { "enums": [ { "name": "equality_op", "schema": "realtime", "values": [ "eq", "neq", "lt", "lte", "gt", "gte", "in" ], "comment": null }, { "name": "action", "schema": "realtime", "values": [ "INSERT", "UPDATE", "DELETE", "TRUNCATE", "ERROR" ], "comment": null } ], "roles": [ { "config": null, "can_login": false, "role_name": "dashboard_user", "bypass_rls": false, "is_superuser": false, "can_create_db": true, "can_create_role": true, "connection_limit": -1, "password_validity": null }, { "config": null, "can_login": false, "role_name": "service_role", "bypass_rls": true, "is_superuser": false, "can_create_db": false, "can_create_role": false, "connection_limit": -1, "password_validity": null }, { "config": [ "statement_timeout=3s" ], "can_login": false, "role_name": "anon", "bypass_rls": false, "is_superuser": false, "can_create_db": false, "can_create_role": false, "connection_limit": -1, "password_validity": null }, { "config": [ "statement_timeout=8s" ], "can_login": false, "role_name": "authenticated", "bypass_rls": false, "is_superuser": false, "can_create_db": false, "can_create_role": false, "connection_limit": -1, "password_validity": null }, { "config": [ "session_preload_libraries=safeupdate", "statement_timeout=8s", "lock_timeout=8s" ], "can_login": true, "role_name": "authenticator", "bypass_rls": false, "is_superuser": false, "can_create_db": false, "can_create_role": false, "connection_limit": -1, "password_validity": null } ], "views": [ { "name": "decrypted_secrets", "owner": "supabase_admin", "schema": "vault", "definition": " SELECT id,\n name,\n description,\n secret,\n convert_from(vault.crypto_aead_det_decrypt(message => decode(secret, 'base64'::text), additional => convert_to((id)::text, 'utf8'::name), key_id => (0)::bigint, context => '\x7067736f6469756d'::bytea, nonce => nonce), 'utf8'::name) AS decrypted_secret,\n key_id,\n nonce,\n created_at,\n updated_at\n FROM vault.secrets s;" }, { "name": "active_supplier_products", "owner": "postgres", "schema": "public", "definition": " SELECT id,\n supplier,\n supplier_product_id,\n reference,\n name,\n description,\n category,\n subcategory,\n product_type,\n price,\n price_unit,\n vat_rate,\n in_stock,\n stock_level,\n brand,\n specifications,\n image_url,\n product_url,\n diameter_mm,\n length_m,\n material,\n last_scraped_at,\n scraper_version,\n is_active,\n created_at,\n updated_at\n FROM supplier_products\n WHERE ((is_active = true) AND (in_stock = true));" } ], "tables": [ { "rls": { "rls_forced": false, "rls_enabled": false }, "name": "active_supplier_products", "type": "VIEW", "grants": [ { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "supplier", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "supplier_product_id", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "reference", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "name", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "description", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "category", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "subcategory", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 8, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "product_type", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 9, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "price", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 10, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "price_unit", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 11, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "vat_rate", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 12, "numeric_precision": 5, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "in_stock", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 13, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "stock_level", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 14, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "brand", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 15, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "specifications", "comment": null, "udt_name": "jsonb", "data_type": "jsonb", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 16, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "image_url", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 17, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "product_url", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 18, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "diameter_mm", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 19, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "length_m", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 20, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "material", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 21, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "last_scraped_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 22, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "scraper_version", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 23, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "is_active", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 24, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 25, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 26, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": null, "indexes": [], "policies": [], "triggers": [], "row_count": -1, "size_bytes": 0, "primary_key": null, "foreign_keys": [], "check_constraints": [], "unique_constraints": [] }, { "rls": { "rls_forced": false, "rls_enabled": true }, "name": "appointments", "type": "BASE TABLE", "grants": [ { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "uuid_generate_v4()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "user_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "client_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "job_site_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "title", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "description", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "location", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "start_time", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 8, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "end_time", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 9, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "duration_minutes", "comment": null, "udt_name": "int4", "data_type": "integer", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 0, "column_default": null, "ordinal_position": 10, "numeric_precision": 32, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "status", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "'scheduled'::text", "ordinal_position": 11, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "reminder_sent", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "false", "ordinal_position": 12, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "reminder_minutes_before", "comment": null, "udt_name": "int4", "data_type": "integer", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 0, "column_default": "60", "ordinal_position": 13, "numeric_precision": 32, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "notes", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 14, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 15, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 16, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "Manages plumber appointments and scheduling", "indexes": [ { "name": "idx_appointments_client_id", "method": "btree", "columns": [ "client_id" ], "is_unique": false, "definition": "CREATE INDEX idx_appointments_client_id ON public.appointments USING btree (client_id)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_appointments_job_site_id", "method": "btree", "columns": [ "job_site_id" ], "is_unique": false, "definition": "CREATE INDEX idx_appointments_job_site_id ON public.appointments USING btree (job_site_id)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_appointments_start_time", "method": "btree", "columns": [ "start_time" ], "is_unique": false, "definition": "CREATE INDEX idx_appointments_start_time ON public.appointments USING btree (start_time)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_appointments_status", "method": "btree", "columns": [ "status" ], "is_unique": false, "definition": "CREATE INDEX idx_appointments_status ON public.appointments USING btree (status)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_appointments_user_start", "method": "btree", "columns": [ "user_id", "start_time" ], "is_unique": false, "definition": "CREATE INDEX idx_appointments_user_start ON public.appointments USING btree (user_id, start_time DESC)", "is_primary": false, "size_bytes": 16384 }, { "name": "appointments_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX appointments_pkey ON public.appointments USING btree (id)", "is_primary": true, "size_bytes": 16384 }, { "name": "idx_appointments_user_id", "method": "btree", "columns": [ "user_id" ], "is_unique": false, "definition": "CREATE INDEX idx_appointments_user_id ON public.appointments USING btree (user_id)", "is_primary": false, "size_bytes": 16384 } ], "policies": [ { "name": "Users can view own appointments", "qual": "(auth.uid() = user_id)", "roles": [ "public" ], "command": "SELECT", "permissive": "PERMISSIVE", "with_check": null }, { "name": "Users can delete own appointments", "qual": "(auth.uid() = user_id)", "roles": [ "public" ], "command": "DELETE", "permissive": "PERMISSIVE", "with_check": null }, { "name": "Users can update own appointments", "qual": "(auth.uid() = user_id)", "roles": [ "public" ], "command": "UPDATE", "permissive": "PERMISSIVE", "with_check": "(auth.uid() = user_id)" }, { "name": "Users can create own appointments", "qual": null, "roles": [ "public" ], "command": "INSERT", "permissive": "PERMISSIVE", "with_check": "(auth.uid() = user_id)" } ], "triggers": [ { "name": "update_appointments_updated_at", "event": "UPDATE", "timing": "BEFORE", "condition": null, "statement": "EXECUTE FUNCTION update_updated_at_column()", "orientation": "ROW" } ], "row_count": -1, "size_bytes": 131072, "primary_key": { "columns": [ "id" ], "constraint_name": "appointments_pkey" }, "foreign_keys": [ { "columns": [ "client_id" ], "delete_rule": "SET NULL", "update_rule": "NO ACTION", "match_option": "NONE", "constraint_name": "appointments_client_id_fkey", "referenced_table": "clients", "referenced_schema": "public", "referenced_columns": [ "id" ] }, { "columns": [ "job_site_id" ], "delete_rule": "SET NULL", "update_rule": "NO ACTION", "match_option": "NONE", "constraint_name": "appointments_job_site_id_fkey", "referenced_table": "job_sites", "referenced_schema": "public", "referenced_columns": [ "id" ] } ], "check_constraints": [ { "check_clause": "(status = ANY (ARRAY['scheduled'::text, 'confirmed'::text, 'in_progress'::text, 'completed'::text, 'cancelled'::text, 'no_show'::text]))", "constraint_name": "appointments_status_check" }, { "check_clause": "user_id IS NOT NULL", "constraint_name": "2200_17631_2_not_null" }, { "check_clause": "title IS NOT NULL", "constraint_name": "2200_17631_5_not_null" }, { "check_clause": "start_time IS NOT NULL", "constraint_name": "2200_17631_8_not_null" }, { "check_clause": "id IS NOT NULL", "constraint_name": "2200_17631_1_not_null" } ], "unique_constraints": [] }, { "rls": { "rls_forced": false, "rls_enabled": true }, "name": "bank_accounts", "type": "BASE TABLE", "grants": [ { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "uuid_generate_v4()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "user_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "account_name", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "bank_name", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "account_number", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "iban", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "bic", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "current_balance", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": "0", "ordinal_position": 8, "numeric_precision": 12, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "last_reconciled_balance", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 9, "numeric_precision": 12, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "last_reconciled_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 10, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "is_active", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "true", "ordinal_position": 11, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "is_default", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "false", "ordinal_position": 12, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 13, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 14, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "User bank accounts for reconciliation", "indexes": [ { "name": "bank_accounts_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX bank_accounts_pkey ON public.bank_accounts USING btree (id)", "is_primary": true, "size_bytes": 8192 }, { "name": "idx_bank_accounts_user", "method": "btree", "columns": [ "user_id" ], "is_unique": false, "definition": "CREATE INDEX idx_bank_accounts_user ON public.bank_accounts USING btree (user_id)", "is_primary": false, "size_bytes": 8192 } ], "policies": [ { "name": "Users can manage their bank accounts", "qual": "(auth.uid() = user_id)", "roles": [ "public" ], "command": "ALL", "permissive": "PERMISSIVE", "with_check": null } ], "triggers": [ { "name": "update_bank_accounts_updated_at", "event": "UPDATE", "timing": "BEFORE", "condition": null, "statement": "EXECUTE FUNCTION update_updated_at_column()", "orientation": "ROW" } ], "row_count": -1, "size_bytes": 24576, "primary_key": { "columns": [ "id" ], "constraint_name": "bank_accounts_pkey" }, "foreign_keys": [], "check_constraints": [ { "check_clause": "user_id IS NOT NULL", "constraint_name": "2200_17850_2_not_null" }, { "check_clause": "account_name IS NOT NULL", "constraint_name": "2200_17850_3_not_null" }, { "check_clause": "id IS NOT NULL", "constraint_name": "2200_17850_1_not_null" } ], "unique_constraints": [] }, { "rls": { "rls_forced": false, "rls_enabled": true }, "name": "bank_transactions", "type": "BASE TABLE", "grants": [ { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "uuid_generate_v4()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "user_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "bank_account_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "transaction_date", "comment": null, "udt_name": "date", "data_type": "date", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "value_date", "comment": null, "udt_name": "date", "data_type": "date", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "description", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "reference", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "amount", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 8, "numeric_precision": 12, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "balance_after", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 9, "numeric_precision": 12, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "category", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 10, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "notes", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 11, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "is_reconciled", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "false", "ordinal_position": 12, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "reconciled_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 13, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "reconciled_with_type", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 14, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "reconciled_with_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 15, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "import_batch_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 16, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "imported_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 17, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 18, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 19, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "Imported bank transactions for reconciliation", "indexes": [ { "name": "idx_bank_transactions_date", "method": "btree", "columns": [ "transaction_date" ], "is_unique": false, "definition": "CREATE INDEX idx_bank_transactions_date ON public.bank_transactions USING btree (transaction_date)", "is_primary": false, "size_bytes": 8192 }, { "name": "idx_bank_transactions_reconciled", "method": "btree", "columns": [ "is_reconciled" ], "is_unique": false, "definition": "CREATE INDEX idx_bank_transactions_reconciled ON public.bank_transactions USING btree (is_reconciled)", "is_primary": false, "size_bytes": 8192 }, { "name": "bank_transactions_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX bank_transactions_pkey ON public.bank_transactions USING btree (id)", "is_primary": true, "size_bytes": 8192 }, { "name": "bank_transactions_bank_account_id_transaction_date_amount_d_key", "method": "btree", "columns": [ "bank_account_id", "transaction_date", "amount", "description" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX bank_transactions_bank_account_id_transaction_date_amount_d_key ON public.bank_transactions USING btree (bank_account_id, transaction_date, amount, description)", "is_primary": false, "size_bytes": 8192 }, { "name": "idx_bank_transactions_account", "method": "btree", "columns": [ "bank_account_id" ], "is_unique": false, "definition": "CREATE INDEX idx_bank_transactions_account ON public.bank_transactions USING btree (bank_account_id)", "is_primary": false, "size_bytes": 8192 } ], "policies": [ { "name": "Users can manage their bank transactions", "qual": "(auth.uid() = user_id)", "roles": [ "public" ], "command": "ALL", "permissive": "PERMISSIVE", "with_check": null } ], "triggers": [ { "name": "update_bank_transactions_updated_at", "event": "UPDATE", "timing": "BEFORE", "condition": null, "statement": "EXECUTE FUNCTION update_updated_at_column()", "orientation": "ROW" } ], "row_count": -1, "size_bytes": 49152, "primary_key": { "columns": [ "id" ], "constraint_name": "bank_transactions_pkey" }, "foreign_keys": [ { "columns": [ "bank_account_id" ], "delete_rule": "CASCADE", "update_rule": "NO ACTION", "match_option": "NONE", "constraint_name": "bank_transactions_bank_account_id_fkey", "referenced_table": "bank_accounts", "referenced_schema": "public", "referenced_columns": [ "id" ] } ], "check_constraints": [ { "check_clause": "bank_account_id IS NOT NULL", "constraint_name": "2200_17868_3_not_null" }, { "check_clause": "(reconciled_with_type = ANY (ARRAY['invoice'::text, 'expense'::text, 'manual'::text]))", "constraint_name": "bank_transactions_reconciled_with_type_check" }, { "check_clause": "id IS NOT NULL", "constraint_name": "2200_17868_1_not_null" }, { "check_clause": "amount IS NOT NULL", "constraint_name": "2200_17868_8_not_null" }, { "check_clause": "description IS NOT NULL", "constraint_name": "2200_17868_6_not_null" }, { "check_clause": "transaction_date IS NOT NULL", "constraint_name": "2200_17868_4_not_null" }, { "check_clause": "user_id IS NOT NULL", "constraint_name": "2200_17868_2_not_null" } ], "unique_constraints": [ { "columns": [ "bank_account_id", "transaction_date", "amount", "description" ], "constraint_name": "bank_transactions_bank_account_id_transaction_date_amount_d_key" } ] }, { "rls": { "rls_forced": false, "rls_enabled": true }, "name": "client_portal_activity", "type": "BASE TABLE", "grants": [ { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "uuid_generate_v4()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "token_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "client_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "activity_type", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "document_type", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "document_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "ip_address", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "user_agent", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 8, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 9, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "Audit log of all client portal activity", "indexes": [ { "name": "idx_portal_activity_created", "method": "btree", "columns": [ "created_at" ], "is_unique": false, "definition": "CREATE INDEX idx_portal_activity_created ON public.client_portal_activity USING btree (created_at)", "is_primary": false, "size_bytes": 8192 }, { "name": "client_portal_activity_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX client_portal_activity_pkey ON public.client_portal_activity USING btree (id)", "is_primary": true, "size_bytes": 8192 }, { "name": "idx_portal_activity_token", "method": "btree", "columns": [ "token_id" ], "is_unique": false, "definition": "CREATE INDEX idx_portal_activity_token ON public.client_portal_activity USING btree (token_id)", "is_primary": false, "size_bytes": 8192 } ], "policies": [ { "name": "Users can view their client portal activity", "qual": "(token_id IN ( SELECT client_portal_tokens.id\n FROM client_portal_tokens\n WHERE (client_portal_tokens.user_id = auth.uid())))", "roles": [ "public" ], "command": "SELECT", "permissive": "PERMISSIVE", "with_check": null } ], "triggers": [], "row_count": -1, "size_bytes": 32768, "primary_key": { "columns": [ "id" ], "constraint_name": "client_portal_activity_pkey" }, "foreign_keys": [ { "columns": [ "client_id" ], "delete_rule": "CASCADE", "update_rule": "NO ACTION", "match_option": "NONE", "constraint_name": "client_portal_activity_client_id_fkey", "referenced_table": "clients", "referenced_schema": "public", "referenced_columns": [ "id" ] }, { "columns": [ "token_id" ], "delete_rule": "CASCADE", "update_rule": "NO ACTION", "match_option": "NONE", "constraint_name": "client_portal_activity_token_id_fkey", "referenced_table": "client_portal_tokens", "referenced_schema": "public", "referenced_columns": [ "id" ] } ], "check_constraints": [ { "check_clause": "id IS NOT NULL", "constraint_name": "2200_17829_1_not_null" }, { "check_clause": "(activity_type = ANY (ARRAY['login'::text, 'view_quote'::text, 'view_invoice'::text, 'download_document'::text, 'payment'::text]))", "constraint_name": "client_portal_activity_activity_type_check" }, { "check_clause": "(document_type = ANY (ARRAY['quote'::text, 'invoice'::text]))", "constraint_name": "client_portal_activity_document_type_check" }, { "check_clause": "activity_type IS NOT NULL", "constraint_name": "2200_17829_4_not_null" }, { "check_clause": "client_id IS NOT NULL", "constraint_name": "2200_17829_3_not_null" }, { "check_clause": "token_id IS NOT NULL", "constraint_name": "2200_17829_2_not_null" } ], "unique_constraints": [] }, { "rls": { "rls_forced": false, "rls_enabled": true }, "name": "client_portal_tokens", "type": "BASE TABLE", "grants": [ { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "uuid_generate_v4()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "user_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "client_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "token", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "expires_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "is_active", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "true", "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "last_accessed_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "access_count", "comment": null, "udt_name": "int4", "data_type": "integer", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 0, "column_default": "0", "ordinal_position": 8, "numeric_precision": 32, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "can_view_quotes", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "true", "ordinal_position": 9, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "can_view_invoices", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "true", "ordinal_position": 10, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "can_download_documents", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "true", "ordinal_position": 11, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "can_pay_invoices", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "false", "ordinal_position": 12, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 13, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 14, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "Secure access tokens for client portal", "indexes": [ { "name": "client_portal_tokens_token_key", "method": "btree", "columns": [ "token" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX client_portal_tokens_token_key ON public.client_portal_tokens USING btree (token)", "is_primary": false, "size_bytes": 8192 }, { "name": "idx_portal_tokens_client", "method": "btree", "columns": [ "client_id" ], "is_unique": false, "definition": "CREATE INDEX idx_portal_tokens_client ON public.client_portal_tokens USING btree (client_id)", "is_primary": false, "size_bytes": 8192 }, { "name": "idx_portal_tokens_token", "method": "btree", "columns": [ "token" ], "is_unique": false, "definition": "CREATE INDEX idx_portal_tokens_token ON public.client_portal_tokens USING btree (token)", "is_primary": false, "size_bytes": 8192 }, { "name": "client_portal_tokens_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX client_portal_tokens_pkey ON public.client_portal_tokens USING btree (id)", "is_primary": true, "size_bytes": 8192 } ], "policies": [ { "name": "Users can manage their client portal tokens", "qual": "(auth.uid() = user_id)", "roles": [ "public" ], "command": "ALL", "permissive": "PERMISSIVE", "with_check": null } ], "triggers": [ { "name": "update_client_portal_tokens_updated_at", "event": "UPDATE", "timing": "BEFORE", "condition": null, "statement": "EXECUTE FUNCTION update_updated_at_column()", "orientation": "ROW" } ], "row_count": -1, "size_bytes": 40960, "primary_key": { "columns": [ "id" ], "constraint_name": "client_portal_tokens_pkey" }, "foreign_keys": [ { "columns": [ "client_id" ], "delete_rule": "CASCADE", "update_rule": "NO ACTION", "match_option": "NONE", "constraint_name": "client_portal_tokens_client_id_fkey", "referenced_table": "clients", "referenced_schema": "public", "referenced_columns": [ "id" ] } ], "check_constraints": [ { "check_clause": "token IS NOT NULL", "constraint_name": "2200_17801_4_not_null" }, { "check_clause": "expires_at IS NOT NULL", "constraint_name": "2200_17801_5_not_null" }, { "check_clause": "client_id IS NOT NULL", "constraint_name": "2200_17801_3_not_null" }, { "check_clause": "user_id IS NOT NULL", "constraint_name": "2200_17801_2_not_null" }, { "check_clause": "id IS NOT NULL", "constraint_name": "2200_17801_1_not_null" } ], "unique_constraints": [ { "columns": [ "token" ], "constraint_name": "client_portal_tokens_token_key" } ] }, { "rls": { "rls_forced": false, "rls_enabled": true }, "name": "clients", "type": "BASE TABLE", "grants": [ { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "uuid_generate_v4()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "user_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "client_type", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "'individual'::text", "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "salutation", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "first_name", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "last_name", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "company_name", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "email", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 8, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "phone", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 9, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "mobile_phone", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 10, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "address", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 11, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "postal_code", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 12, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "city", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 13, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "country", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "'France'::text", "ordinal_position": 14, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "billing_address", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 15, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "siret", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 16, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "vat_number", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 17, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "default_payment_terms", "comment": null, "udt_name": "int4", "data_type": "integer", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 0, "column_default": "30", "ordinal_position": 18, "numeric_precision": 32, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "default_discount", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": "0", "ordinal_position": 19, "numeric_precision": 5, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "tags", "comment": null, "udt_name": "text", "data_type": "ARRAY", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 20, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "is_favorite", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "false", "ordinal_position": 21, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "notes", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 22, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 23, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 24, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "Stores client information (individuals and companies)", "indexes": [ { "name": "clients_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX clients_pkey ON public.clients USING btree (id)", "is_primary": true, "size_bytes": 16384 }, { "name": "idx_clients_user_id", "method": "btree", "columns": [ "user_id" ], "is_unique": false, "definition": "CREATE INDEX idx_clients_user_id ON public.clients USING btree (user_id)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_clients_email", "method": "btree", "columns": [ "email" ], "is_unique": false, "definition": "CREATE INDEX idx_clients_email ON public.clients USING btree (email)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_clients_is_favorite", "method": "btree", "columns": [ "is_favorite" ], "is_unique": false, "definition": "CREATE INDEX idx_clients_is_favorite ON public.clients USING btree (is_favorite)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_clients_client_type", "method": "btree", "columns": [ "client_type" ], "is_unique": false, "definition": "CREATE INDEX idx_clients_client_type ON public.clients USING btree (client_type)", "is_primary": false, "size_bytes": 16384 } ], "policies": [ { "name": "Users can manage their own clients", "qual": "(auth.uid() = user_id)", "roles": [ "public" ], "command": "ALL", "permissive": "PERMISSIVE", "with_check": null } ], "triggers": [ { "name": "update_clients_updated_at", "event": "UPDATE", "timing": "BEFORE", "condition": null, "statement": "EXECUTE FUNCTION update_updated_at_column()", "orientation": "ROW" } ], "row_count": -1, "size_bytes": 98304, "primary_key": { "columns": [ "id" ], "constraint_name": "clients_pkey" }, "foreign_keys": [], "check_constraints": [ { "check_clause": "phone IS NOT NULL", "constraint_name": "2200_17451_9_not_null" }, { "check_clause": "id IS NOT NULL", "constraint_name": "2200_17451_1_not_null" }, { "check_clause": "user_id IS NOT NULL", "constraint_name": "2200_17451_2_not_null" }, { "check_clause": "(client_type = ANY (ARRAY['individual'::text, 'company'::text]))", "constraint_name": "clients_client_type_check" }, { "check_clause": "email IS NOT NULL", "constraint_name": "2200_17451_8_not_null" } ], "unique_constraints": [] }, { "rls": { "rls_forced": false, "rls_enabled": true }, "name": "invoices", "type": "BASE TABLE", "grants": [ { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "uuid_generate_v4()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "user_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "client_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "number", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "date", "comment": null, "udt_name": "date", "data_type": "date", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "due_date", "comment": null, "udt_name": "date", "data_type": "date", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "status", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "'draft'::text", "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "payment_status", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "'unpaid'::text", "ordinal_position": 8, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "total_ht", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": "0", "ordinal_position": 9, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "tva_amount", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": "0", "ordinal_position": 10, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "total_ttc", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": "0", "ordinal_position": 11, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "amount_paid", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": "0", "ordinal_position": 12, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "balance_due", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": "0", "ordinal_position": 13, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "payment_method", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 14, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "is_electronic", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "false", "ordinal_position": 15, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "xml_url", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 16, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "is_progress_invoice", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "false", "ordinal_position": 17, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "parent_quote_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 18, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "progress_percentage", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 19, "numeric_precision": 5, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "payment_number", "comment": null, "udt_name": "int4", "data_type": "integer", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 0, "column_default": null, "ordinal_position": 20, "numeric_precision": 32, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "total_payments", "comment": null, "udt_name": "int4", "data_type": "integer", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 0, "column_default": null, "ordinal_position": 21, "numeric_precision": 32, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "is_final_payment", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "false", "ordinal_position": 22, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "notes", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 23, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "terms_and_conditions", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 24, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 25, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 26, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "Customer invoices with payment tracking", "indexes": [ { "name": "idx_invoices_due_date", "method": "btree", "columns": [ "due_date" ], "is_unique": false, "definition": "CREATE INDEX idx_invoices_due_date ON public.invoices USING btree (due_date)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_invoices_user_id", "method": "btree", "columns": [ "user_id" ], "is_unique": false, "definition": "CREATE INDEX idx_invoices_user_id ON public.invoices USING btree (user_id)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_invoices_client_id", "method": "btree", "columns": [ "client_id" ], "is_unique": false, "definition": "CREATE INDEX idx_invoices_client_id ON public.invoices USING btree (client_id)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_invoices_status", "method": "btree", "columns": [ "status" ], "is_unique": false, "definition": "CREATE INDEX idx_invoices_status ON public.invoices USING btree (status)", "is_primary": false, "size_bytes": 16384 }, { "name": "invoices_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX invoices_pkey ON public.invoices USING btree (id)", "is_primary": true, "size_bytes": 16384 }, { "name": "invoices_number_key", "method": "btree", "columns": [ "number" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX invoices_number_key ON public.invoices USING btree (number)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_invoices_payment_status", "method": "btree", "columns": [ "payment_status" ], "is_unique": false, "definition": "CREATE INDEX idx_invoices_payment_status ON public.invoices USING btree (payment_status)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_invoices_date", "method": "btree", "columns": [ "date" ], "is_unique": false, "definition": "CREATE INDEX idx_invoices_date ON public.invoices USING btree (date)", "is_primary": false, "size_bytes": 16384 } ], "policies": [ { "name": "Users can manage their own invoices", "qual": "(auth.uid() = user_id)", "roles": [ "public" ], "command": "ALL", "permissive": "PERMISSIVE", "with_check": null } ], "triggers": [ { "name": "update_invoices_updated_at", "event": "UPDATE", "timing": "BEFORE", "condition": null, "statement": "EXECUTE FUNCTION update_updated_at_column()", "orientation": "ROW" } ], "row_count": -1, "size_bytes": 147456, "primary_key": { "columns": [ "id" ], "constraint_name": "invoices_pkey" }, "foreign_keys": [ { "columns": [ "parent_quote_id" ], "delete_rule": "SET NULL", "update_rule": "NO ACTION", "match_option": "NONE", "constraint_name": "invoices_parent_quote_id_fkey", "referenced_table": "quotes", "referenced_schema": "public", "referenced_columns": [ "id" ] }, { "columns": [ "client_id" ], "delete_rule": "SET NULL", "update_rule": "NO ACTION", "match_option": "NONE", "constraint_name": "invoices_client_id_fkey", "referenced_table": "clients", "referenced_schema": "public", "referenced_columns": [ "id" ] } ], "check_constraints": [ { "check_clause": "((progress_percentage >= (0)::numeric) AND (progress_percentage <= (100)::numeric))", "constraint_name": "invoices_progress_percentage_check" }, { "check_clause": "(status = ANY (ARRAY['draft'::text, 'sent'::text, 'paid'::text, 'overdue'::text, 'cancelled'::text]))", "constraint_name": "invoices_status_check" }, { "check_clause": "(payment_status = ANY (ARRAY['unpaid'::text, 'partial'::text, 'paid'::text]))", "constraint_name": "invoices_payment_status_check" }, { "check_clause": "id IS NOT NULL", "constraint_name": "2200_17541_1_not_null" }, { "check_clause": "user_id IS NOT NULL", "constraint_name": "2200_17541_2_not_null" }, { "check_clause": "number IS NOT NULL", "constraint_name": "2200_17541_4_not_null" }, { "check_clause": "date IS NOT NULL", "constraint_name": "2200_17541_5_not_null" } ], "unique_constraints": [ { "columns": [ "number" ], "constraint_name": "invoices_number_key" } ] }, { "rls": { "rls_forced": false, "rls_enabled": true }, "name": "job_sites", "type": "BASE TABLE", "grants": [ { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "uuid_generate_v4()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "user_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "client_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "job_name", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "reference_number", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "address", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "contact_person", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "contact_phone", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 8, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "description", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 9, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "start_date", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 10, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "estimated_end_date", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 11, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "actual_end_date", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 12, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "status", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "'planned'::text", "ordinal_position": 13, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "progress_percentage", "comment": null, "udt_name": "int4", "data_type": "integer", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 0, "column_default": "0", "ordinal_position": 14, "numeric_precision": 32, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "related_quote_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 15, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "estimated_budget", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 16, "numeric_precision": 12, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "actual_cost", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 17, "numeric_precision": 12, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "profit_margin", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 18, "numeric_precision": 12, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "notes", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 19, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 20, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 21, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "Tracks job sites and project work locations", "indexes": [ { "name": "idx_job_sites_status", "method": "btree", "columns": [ "status" ], "is_unique": false, "definition": "CREATE INDEX idx_job_sites_status ON public.job_sites USING btree (status)", "is_primary": false, "size_bytes": 16384 }, { "name": "job_sites_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX job_sites_pkey ON public.job_sites USING btree (id)", "is_primary": true, "size_bytes": 16384 }, { "name": "idx_job_sites_client_id", "method": "btree", "columns": [ "client_id" ], "is_unique": false, "definition": "CREATE INDEX idx_job_sites_client_id ON public.job_sites USING btree (client_id)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_job_sites_user_id", "method": "btree", "columns": [ "user_id" ], "is_unique": false, "definition": "CREATE INDEX idx_job_sites_user_id ON public.job_sites USING btree (user_id)", "is_primary": false, "size_bytes": 16384 } ], "policies": [ { "name": "Users can manage their own job sites", "qual": "(auth.uid() = user_id)", "roles": [ "public" ], "command": "ALL", "permissive": "PERMISSIVE", "with_check": null } ], "triggers": [ { "name": "update_job_sites_updated_at", "event": "UPDATE", "timing": "BEFORE", "condition": null, "statement": "EXECUTE FUNCTION update_updated_at_column()", "orientation": "ROW" } ], "row_count": -1, "size_bytes": 81920, "primary_key": { "columns": [ "id" ], "constraint_name": "job_sites_pkey" }, "foreign_keys": [ { "columns": [ "client_id" ], "delete_rule": "CASCADE", "update_rule": "NO ACTION", "match_option": "NONE", "constraint_name": "job_sites_client_id_fkey", "referenced_table": "clients", "referenced_schema": "public", "referenced_columns": [ "id" ] } ], "check_constraints": [ { "check_clause": "((progress_percentage >= 0) AND (progress_percentage <= 100))", "constraint_name": "job_sites_progress_percentage_check" }, { "check_clause": "job_name IS NOT NULL", "constraint_name": "2200_17472_4_not_null" }, { "check_clause": "client_id IS NOT NULL", "constraint_name": "2200_17472_3_not_null" }, { "check_clause": "user_id IS NOT NULL", "constraint_name": "2200_17472_2_not_null" }, { "check_clause": "id IS NOT NULL", "constraint_name": "2200_17472_1_not_null" }, { "check_clause": "(status = ANY (ARRAY['planned'::text, 'in_progress'::text, 'on_hold'::text, 'completed'::text, 'cancelled'::text]))", "constraint_name": "job_sites_status_check" } ], "unique_constraints": [] }, { "rls": { "rls_forced": false, "rls_enabled": true }, "name": "line_items", "type": "BASE TABLE", "grants": [ { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "uuid_generate_v4()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "quote_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "invoice_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "product_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "description", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "quantity", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": 2, "column_default": "1", "ordinal_position": 6, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "unit_price", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 7, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "discount_percent", "comment": null, "udt_name": "int4", "data_type": "integer", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 0, "column_default": "0", "ordinal_position": 8, "numeric_precision": 32, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "tax_rate", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": "20.0", "ordinal_position": 9, "numeric_precision": 5, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "unit", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "'unit'::text", "ordinal_position": 10, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "position", "comment": null, "udt_name": "int4", "data_type": "integer", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 0, "column_default": "0", "ordinal_position": 11, "numeric_precision": 32, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 12, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "Line items for quotes and invoices", "indexes": [ { "name": "line_items_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX line_items_pkey ON public.line_items USING btree (id)", "is_primary": true, "size_bytes": 16384 }, { "name": "idx_line_items_product_id", "method": "btree", "columns": [ "product_id" ], "is_unique": false, "definition": "CREATE INDEX idx_line_items_product_id ON public.line_items USING btree (product_id)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_line_items_invoice_id", "method": "btree", "columns": [ "invoice_id" ], "is_unique": false, "definition": "CREATE INDEX idx_line_items_invoice_id ON public.line_items USING btree (invoice_id)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_line_items_quote_id", "method": "btree", "columns": [ "quote_id" ], "is_unique": false, "definition": "CREATE INDEX idx_line_items_quote_id ON public.line_items USING btree (quote_id)", "is_primary": false, "size_bytes": 16384 } ], "policies": [ { "name": "Users can manage line items for their documents", "qual": "((quote_id IN ( SELECT quotes.id\n FROM quotes\n WHERE (quotes.user_id = auth.uid()))) OR (invoice_id IN ( SELECT invoices.id\n FROM invoices\n WHERE (invoices.user_id = auth.uid()))))", "roles": [ "public" ], "command": "ALL", "permissive": "PERMISSIVE", "with_check": null } ], "triggers": [], "row_count": -1, "size_bytes": 81920, "primary_key": { "columns": [ "id" ], "constraint_name": "line_items_pkey" }, "foreign_keys": [ { "columns": [ "product_id" ], "delete_rule": "SET NULL", "update_rule": "NO ACTION", "match_option": "NONE", "constraint_name": "line_items_product_id_fkey", "referenced_table": "products", "referenced_schema": "public", "referenced_columns": [ "id" ] }, { "columns": [ "quote_id" ], "delete_rule": "CASCADE", "update_rule": "NO ACTION", "match_option": "NONE", "constraint_name": "line_items_quote_id_fkey", "referenced_table": "quotes", "referenced_schema": "public", "referenced_columns": [ "id" ] }, { "columns": [ "invoice_id" ], "delete_rule": "CASCADE", "update_rule": "NO ACTION", "match_option": "NONE", "constraint_name": "line_items_invoice_id_fkey", "referenced_table": "invoices", "referenced_schema": "public", "referenced_columns": [ "id" ] } ], "check_constraints": [ { "check_clause": "id IS NOT NULL", "constraint_name": "2200_17581_1_not_null" }, { "check_clause": "quantity IS NOT NULL", "constraint_name": "2200_17581_6_not_null" }, { "check_clause": "unit_price IS NOT NULL", "constraint_name": "2200_17581_7_not_null" }, { "check_clause": "(((quote_id IS NOT NULL) AND (invoice_id IS NULL)) OR ((quote_id IS NULL) AND (invoice_id IS NOT NULL)))", "constraint_name": "line_item_parent_check" }, { "check_clause": "description IS NOT NULL", "constraint_name": "2200_17581_5_not_null" } ], "unique_constraints": [] }, { "rls": { "rls_forced": false, "rls_enabled": true }, "name": "payments", "type": "BASE TABLE", "grants": [ { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "uuid_generate_v4()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "user_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "invoice_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "payment_date", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "amount", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 5, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "payment_method", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "transaction_reference", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "stripe_payment_id", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 8, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "receipt_url", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 9, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "notes", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 10, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "is_reconciled", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "false", "ordinal_position": 11, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 12, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "Payment records for invoices", "indexes": [ { "name": "idx_payments_date", "method": "btree", "columns": [ "payment_date" ], "is_unique": false, "definition": "CREATE INDEX idx_payments_date ON public.payments USING btree (payment_date)", "is_primary": false, "size_bytes": 16384 }, { "name": "payments_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX payments_pkey ON public.payments USING btree (id)", "is_primary": true, "size_bytes": 16384 }, { "name": "idx_payments_user_id", "method": "btree", "columns": [ "user_id" ], "is_unique": false, "definition": "CREATE INDEX idx_payments_user_id ON public.payments USING btree (user_id)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_payments_invoice_id", "method": "btree", "columns": [ "invoice_id" ], "is_unique": false, "definition": "CREATE INDEX idx_payments_invoice_id ON public.payments USING btree (invoice_id)", "is_primary": false, "size_bytes": 16384 } ], "policies": [ { "name": "Users can manage their own payments", "qual": "(auth.uid() = user_id)", "roles": [ "public" ], "command": "ALL", "permissive": "PERMISSIVE", "with_check": null } ], "triggers": [], "row_count": -1, "size_bytes": 81920, "primary_key": { "columns": [ "id" ], "constraint_name": "payments_pkey" }, "foreign_keys": [ { "columns": [ "invoice_id" ], "delete_rule": "CASCADE", "update_rule": "NO ACTION", "match_option": "NONE", "constraint_name": "payments_invoice_id_fkey", "referenced_table": "invoices", "referenced_schema": "public", "referenced_columns": [ "id" ] } ], "check_constraints": [ { "check_clause": "invoice_id IS NOT NULL", "constraint_name": "2200_17611_3_not_null" }, { "check_clause": "id IS NOT NULL", "constraint_name": "2200_17611_1_not_null" }, { "check_clause": "user_id IS NOT NULL", "constraint_name": "2200_17611_2_not_null" }, { "check_clause": "payment_date IS NOT NULL", "constraint_name": "2200_17611_4_not_null" }, { "check_clause": "amount IS NOT NULL", "constraint_name": "2200_17611_5_not_null" } ], "unique_constraints": [] }, { "rls": { "rls_forced": false, "rls_enabled": true }, "name": "products", "type": "BASE TABLE", "grants": [ { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "uuid_generate_v4()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "user_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "ref", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "name", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "description", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "price_buy", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 6, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "price_sell", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 7, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "unit", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "'unit'::text", "ordinal_position": 8, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "category", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 9, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "supplier", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 10, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "photo_url", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 11, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "is_favorite", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "false", "ordinal_position": 12, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "usage_count", "comment": null, "udt_name": "int4", "data_type": "integer", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 0, "column_default": "0", "ordinal_position": 13, "numeric_precision": 32, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "source", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 14, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 15, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 16, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "User custom products and services catalog", "indexes": [ { "name": "idx_products_is_favorite", "method": "btree", "columns": [ "is_favorite" ], "is_unique": false, "definition": "CREATE INDEX idx_products_is_favorite ON public.products USING btree (is_favorite)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_products_user_id", "method": "btree", "columns": [ "user_id" ], "is_unique": false, "definition": "CREATE INDEX idx_products_user_id ON public.products USING btree (user_id)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_products_category", "method": "btree", "columns": [ "category" ], "is_unique": false, "definition": "CREATE INDEX idx_products_category ON public.products USING btree (category)", "is_primary": false, "size_bytes": 16384 }, { "name": "products_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX products_pkey ON public.products USING btree (id)", "is_primary": true, "size_bytes": 16384 } ], "policies": [ { "name": "Users can manage their own products", "qual": "(auth.uid() = user_id)", "roles": [ "public" ], "command": "ALL", "permissive": "PERMISSIVE", "with_check": null } ], "triggers": [ { "name": "update_products_updated_at", "event": "UPDATE", "timing": "BEFORE", "condition": null, "statement": "EXECUTE FUNCTION update_updated_at_column()", "orientation": "ROW" } ], "row_count": -1, "size_bytes": 81920, "primary_key": { "columns": [ "id" ], "constraint_name": "products_pkey" }, "foreign_keys": [], "check_constraints": [ { "check_clause": "price_sell IS NOT NULL", "constraint_name": "2200_17496_7_not_null" }, { "check_clause": "name IS NOT NULL", "constraint_name": "2200_17496_4_not_null" }, { "check_clause": "id IS NOT NULL", "constraint_name": "2200_17496_1_not_null" }, { "check_clause": "user_id IS NOT NULL", "constraint_name": "2200_17496_2_not_null" } ], "unique_constraints": [] }, { "rls": { "rls_forced": false, "rls_enabled": false }, "name": "profiles", "type": "BASE TABLE", "grants": [ { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "email", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "first_name", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "last_name", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "company_name", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "siret", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "phone", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "address", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 8, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "postal_code", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 9, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "city", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 10, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "country", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "'France'::text", "ordinal_position": 11, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "tva_number", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 12, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "logo_url", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 13, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "iban", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 14, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "bic", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 15, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "stripe_connect_id", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 16, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "subscription_plan", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "'free'::text", "ordinal_position": 17, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "subscription_status", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 18, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "trial_end_date", "comment": null, "udt_name": "timestamp", "data_type": "timestamp without time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 19, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamp", "data_type": "timestamp without time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 20, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamp", "data_type": "timestamp without time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 21, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "full_name", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 22, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "company_type", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 23, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": null, "indexes": [ { "name": "profiles_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX profiles_pkey ON public.profiles USING btree (id)", "is_primary": true, "size_bytes": 16384 } ], "policies": [], "triggers": [], "row_count": -1, "size_bytes": 32768, "primary_key": { "columns": [ "id" ], "constraint_name": "profiles_pkey" }, "foreign_keys": [], "check_constraints": [ { "check_clause": "id IS NOT NULL", "constraint_name": "2200_18162_1_not_null" } ], "unique_constraints": [] }, { "rls": { "rls_forced": false, "rls_enabled": true }, "name": "progress_invoice_schedule", "type": "BASE TABLE", "grants": [ { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "uuid_generate_v4()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "user_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "quote_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "schedule_name", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "total_amount", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 5, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "milestones", "comment": null, "udt_name": "jsonb", "data_type": "jsonb", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "'[]'::jsonb", "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "status", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "'active'::text", "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 8, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 9, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "Defines payment milestones for progress invoicing", "indexes": [ { "name": "progress_invoice_schedule_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX progress_invoice_schedule_pkey ON public.progress_invoice_schedule USING btree (id)", "is_primary": true, "size_bytes": 8192 }, { "name": "idx_progress_schedule_user", "method": "btree", "columns": [ "user_id" ], "is_unique": false, "definition": "CREATE INDEX idx_progress_schedule_user ON public.progress_invoice_schedule USING btree (user_id)", "is_primary": false, "size_bytes": 8192 }, { "name": "idx_progress_schedule_quote", "method": "btree", "columns": [ "quote_id" ], "is_unique": false, "definition": "CREATE INDEX idx_progress_schedule_quote ON public.progress_invoice_schedule USING btree (quote_id)", "is_primary": false, "size_bytes": 8192 }, { "name": "progress_invoice_schedule_quote_id_key", "method": "btree", "columns": [ "quote_id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX progress_invoice_schedule_quote_id_key ON public.progress_invoice_schedule USING btree (quote_id)", "is_primary": false, "size_bytes": 8192 } ], "policies": [ { "name": "Users can manage their progress schedules", "qual": "(auth.uid() = user_id)", "roles": [ "public" ], "command": "ALL", "permissive": "PERMISSIVE", "with_check": null } ], "triggers": [ { "name": "update_progress_invoice_schedule_updated_at", "event": "UPDATE", "timing": "BEFORE", "condition": null, "statement": "EXECUTE FUNCTION update_updated_at_column()", "orientation": "ROW" } ], "row_count": -1, "size_bytes": 40960, "primary_key": { "columns": [ "id" ], "constraint_name": "progress_invoice_schedule_pkey" }, "foreign_keys": [ { "columns": [ "quote_id" ], "delete_rule": "CASCADE", "update_rule": "NO ACTION", "match_option": "NONE", "constraint_name": "progress_invoice_schedule_quote_id_fkey", "referenced_table": "quotes", "referenced_schema": "public", "referenced_columns": [ "id" ] } ], "check_constraints": [ { "check_clause": "id IS NOT NULL", "constraint_name": "2200_17776_1_not_null" }, { "check_clause": "user_id IS NOT NULL", "constraint_name": "2200_17776_2_not_null" }, { "check_clause": "(status = ANY (ARRAY['active'::text, 'completed'::text, 'cancelled'::text]))", "constraint_name": "progress_invoice_schedule_status_check" }, { "check_clause": "milestones IS NOT NULL", "constraint_name": "2200_17776_6_not_null" }, { "check_clause": "total_amount IS NOT NULL", "constraint_name": "2200_17776_5_not_null" }, { "check_clause": "quote_id IS NOT NULL", "constraint_name": "2200_17776_3_not_null" } ], "unique_constraints": [ { "columns": [ "quote_id" ], "constraint_name": "progress_invoice_schedule_quote_id_key" } ] }, { "rls": { "rls_forced": false, "rls_enabled": true }, "name": "quotes", "type": "BASE TABLE", "grants": [ { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "uuid_generate_v4()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "user_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "client_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "quote_number", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "quote_date", "comment": null, "udt_name": "date", "data_type": "date", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "expiry_date", "comment": null, "udt_name": "date", "data_type": "date", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "status", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "'draft'::text", "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "subtotal_ht", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": "0", "ordinal_position": 8, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "total_vat", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": "0", "ordinal_position": 9, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "total_ttc", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": "0", "ordinal_position": 10, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "notes", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 11, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "terms_and_conditions", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 12, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 13, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 14, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "Customer quotations and estimates", "indexes": [ { "name": "idx_quotes_client_id", "method": "btree", "columns": [ "client_id" ], "is_unique": false, "definition": "CREATE INDEX idx_quotes_client_id ON public.quotes USING btree (client_id)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_quotes_user_id", "method": "btree", "columns": [ "user_id" ], "is_unique": false, "definition": "CREATE INDEX idx_quotes_user_id ON public.quotes USING btree (user_id)", "is_primary": false, "size_bytes": 16384 }, { "name": "quotes_quote_number_key", "method": "btree", "columns": [ "quote_number" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX quotes_quote_number_key ON public.quotes USING btree (quote_number)", "is_primary": false, "size_bytes": 16384 }, { "name": "quotes_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX quotes_pkey ON public.quotes USING btree (id)", "is_primary": true, "size_bytes": 16384 }, { "name": "idx_quotes_date", "method": "btree", "columns": [ "quote_date" ], "is_unique": false, "definition": "CREATE INDEX idx_quotes_date ON public.quotes USING btree (quote_date)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_quotes_status", "method": "btree", "columns": [ "status" ], "is_unique": false, "definition": "CREATE INDEX idx_quotes_status ON public.quotes USING btree (status)", "is_primary": false, "size_bytes": 16384 } ], "policies": [ { "name": "Users can manage their own quotes", "qual": "(auth.uid() = user_id)", "roles": [ "public" ], "command": "ALL", "permissive": "PERMISSIVE", "with_check": null } ], "triggers": [ { "name": "update_quotes_updated_at", "event": "UPDATE", "timing": "BEFORE", "condition": null, "statement": "EXECUTE FUNCTION update_updated_at_column()", "orientation": "ROW" } ], "row_count": -1, "size_bytes": 114688, "primary_key": { "columns": [ "id" ], "constraint_name": "quotes_pkey" }, "foreign_keys": [ { "columns": [ "client_id" ], "delete_rule": "SET NULL", "update_rule": "NO ACTION", "match_option": "NONE", "constraint_name": "quotes_client_id_fkey", "referenced_table": "clients", "referenced_schema": "public", "referenced_columns": [ "id" ] } ], "check_constraints": [ { "check_clause": "(status = ANY (ARRAY['draft'::text, 'sent'::text, 'accepted'::text, 'refused'::text, 'expired'::text]))", "constraint_name": "quotes_status_check" }, { "check_clause": "id IS NOT NULL", "constraint_name": "2200_17514_1_not_null" }, { "check_clause": "user_id IS NOT NULL", "constraint_name": "2200_17514_2_not_null" }, { "check_clause": "quote_number IS NOT NULL", "constraint_name": "2200_17514_4_not_null" }, { "check_clause": "quote_date IS NOT NULL", "constraint_name": "2200_17514_5_not_null" } ], "unique_constraints": [ { "columns": [ "quote_number" ], "constraint_name": "quotes_quote_number_key" } ] }, { "rls": { "rls_forced": false, "rls_enabled": true }, "name": "reconciliation_rules", "type": "BASE TABLE", "grants": [ { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "uuid_generate_v4()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "user_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "rule_name", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "description", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "match_description_pattern", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "match_amount_min", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 6, "numeric_precision": 12, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "match_amount_max", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 7, "numeric_precision": 12, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "auto_categorize_as", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 8, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "auto_reconcile", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "false", "ordinal_position": 9, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "is_active", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "true", "ordinal_position": 10, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "priority", "comment": null, "udt_name": "int4", "data_type": "integer", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 0, "column_default": "0", "ordinal_position": 11, "numeric_precision": 32, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 12, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 13, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "Automatic matching rules for bank reconciliation", "indexes": [ { "name": "reconciliation_rules_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX reconciliation_rules_pkey ON public.reconciliation_rules USING btree (id)", "is_primary": true, "size_bytes": 8192 }, { "name": "idx_reconciliation_rules_user", "method": "btree", "columns": [ "user_id" ], "is_unique": false, "definition": "CREATE INDEX idx_reconciliation_rules_user ON public.reconciliation_rules USING btree (user_id)", "is_primary": false, "size_bytes": 8192 } ], "policies": [ { "name": "Users can manage their reconciliation rules", "qual": "(auth.uid() = user_id)", "roles": [ "public" ], "command": "ALL", "permissive": "PERMISSIVE", "with_check": null } ], "triggers": [ { "name": "update_reconciliation_rules_updated_at", "event": "UPDATE", "timing": "BEFORE", "condition": null, "statement": "EXECUTE FUNCTION update_updated_at_column()", "orientation": "ROW" } ], "row_count": -1, "size_bytes": 24576, "primary_key": { "columns": [ "id" ], "constraint_name": "reconciliation_rules_pkey" }, "foreign_keys": [], "check_constraints": [ { "check_clause": "rule_name IS NOT NULL", "constraint_name": "2200_17893_3_not_null" }, { "check_clause": "id IS NOT NULL", "constraint_name": "2200_17893_1_not_null" }, { "check_clause": "user_id IS NOT NULL", "constraint_name": "2200_17893_2_not_null" } ], "unique_constraints": [] }, { "rls": { "rls_forced": false, "rls_enabled": true }, "name": "recurring_invoice_history", "type": "BASE TABLE", "grants": [ { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "uuid_generate_v4()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "recurring_invoice_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "invoice_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "generated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "period_start", "comment": null, "udt_name": "date", "data_type": "date", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "period_end", "comment": null, "udt_name": "date", "data_type": "date", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "status", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "'generated'::text", "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "Tracks all invoices generated from recurring templates", "indexes": [ { "name": "recurring_invoice_history_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX recurring_invoice_history_pkey ON public.recurring_invoice_history USING btree (id)", "is_primary": true, "size_bytes": 8192 } ], "policies": [ { "name": "Users can view their recurring invoice history", "qual": "(recurring_invoice_id IN ( SELECT recurring_invoices.id\n FROM recurring_invoices\n WHERE (recurring_invoices.user_id = auth.uid())))", "roles": [ "public" ], "command": "SELECT", "permissive": "PERMISSIVE", "with_check": null } ], "triggers": [], "row_count": -1, "size_bytes": 16384, "primary_key": { "columns": [ "id" ], "constraint_name": "recurring_invoice_history_pkey" }, "foreign_keys": [ { "columns": [ "recurring_invoice_id" ], "delete_rule": "CASCADE", "update_rule": "NO ACTION", "match_option": "NONE", "constraint_name": "recurring_invoice_history_recurring_invoice_id_fkey", "referenced_table": "recurring_invoices", "referenced_schema": "public", "referenced_columns": [ "id" ] }, { "columns": [ "invoice_id" ], "delete_rule": "SET NULL", "update_rule": "NO ACTION", "match_option": "NONE", "constraint_name": "recurring_invoice_history_invoice_id_fkey", "referenced_table": "invoices", "referenced_schema": "public", "referenced_columns": [ "id" ] } ], "check_constraints": [ { "check_clause": "id IS NOT NULL", "constraint_name": "2200_17755_1_not_null" }, { "check_clause": "recurring_invoice_id IS NOT NULL", "constraint_name": "2200_17755_2_not_null" }, { "check_clause": "invoice_id IS NOT NULL", "constraint_name": "2200_17755_3_not_null" }, { "check_clause": "(status = ANY (ARRAY['generated'::text, 'sent'::text, 'paid'::text, 'failed'::text]))", "constraint_name": "recurring_invoice_history_status_check" } ], "unique_constraints": [] }, { "rls": { "rls_forced": false, "rls_enabled": true }, "name": "recurring_invoice_items", "type": "BASE TABLE", "grants": [ { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "uuid_generate_v4()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "recurring_invoice_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "product_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "description", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "quantity", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": 2, "column_default": "1", "ordinal_position": 5, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "unit_price", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 6, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "tax_rate", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": "20.0", "ordinal_position": 7, "numeric_precision": 5, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "discount_percentage", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": "0", "ordinal_position": 8, "numeric_precision": 5, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "total_ht", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "ALWAYS", "numeric_scale": 2, "column_default": null, "ordinal_position": 9, "numeric_precision": 10, "identity_generation": null, "generation_expression": "((quantity * unit_price) * ((1)::numeric - (discount_percentage / (100)::numeric)))", "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 10, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 11, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "Line items for recurring invoice templates", "indexes": [ { "name": "recurring_invoice_items_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX recurring_invoice_items_pkey ON public.recurring_invoice_items USING btree (id)", "is_primary": true, "size_bytes": 8192 } ], "policies": [ { "name": "Users can manage their recurring invoice items", "qual": "(recurring_invoice_id IN ( SELECT recurring_invoices.id\n FROM recurring_invoices\n WHERE (recurring_invoices.user_id = auth.uid())))", "roles": [ "public" ], "command": "ALL", "permissive": "PERMISSIVE", "with_check": null } ], "triggers": [ { "name": "update_recurring_invoice_items_updated_at", "event": "UPDATE", "timing": "BEFORE", "condition": null, "statement": "EXECUTE FUNCTION update_updated_at_column()", "orientation": "ROW" } ], "row_count": -1, "size_bytes": 16384, "primary_key": { "columns": [ "id" ], "constraint_name": "recurring_invoice_items_pkey" }, "foreign_keys": [ { "columns": [ "product_id" ], "delete_rule": "SET NULL", "update_rule": "NO ACTION", "match_option": "NONE", "constraint_name": "recurring_invoice_items_product_id_fkey", "referenced_table": "products", "referenced_schema": "public", "referenced_columns": [ "id" ] }, { "columns": [ "recurring_invoice_id" ], "delete_rule": "CASCADE", "update_rule": "NO ACTION", "match_option": "NONE", "constraint_name": "recurring_invoice_items_recurring_invoice_id_fkey", "referenced_table": "recurring_invoices", "referenced_schema": "public", "referenced_columns": [ "id" ] } ], "check_constraints": [ { "check_clause": "id IS NOT NULL", "constraint_name": "2200_17731_1_not_null" }, { "check_clause": "recurring_invoice_id IS NOT NULL", "constraint_name": "2200_17731_2_not_null" }, { "check_clause": "description IS NOT NULL", "constraint_name": "2200_17731_4_not_null" }, { "check_clause": "quantity IS NOT NULL", "constraint_name": "2200_17731_5_not_null" }, { "check_clause": "unit_price IS NOT NULL", "constraint_name": "2200_17731_6_not_null" } ], "unique_constraints": [] }, { "rls": { "rls_forced": false, "rls_enabled": true }, "name": "recurring_invoices", "type": "BASE TABLE", "grants": [ { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "uuid_generate_v4()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "user_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "client_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "template_name", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "description", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "invoice_prefix", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "'REC'::text", "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "payment_terms", "comment": null, "udt_name": "int4", "data_type": "integer", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 0, "column_default": "30", "ordinal_position": 7, "numeric_precision": 32, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "notes", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 8, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "terms_and_conditions", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 9, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "frequency", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 10, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "interval_count", "comment": null, "udt_name": "int4", "data_type": "integer", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 0, "column_default": "1", "ordinal_position": 11, "numeric_precision": 32, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "start_date", "comment": null, "udt_name": "date", "data_type": "date", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 12, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "end_date", "comment": null, "udt_name": "date", "data_type": "date", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 13, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "generate_days_before", "comment": null, "udt_name": "int4", "data_type": "integer", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 0, "column_default": "5", "ordinal_position": 14, "numeric_precision": 32, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "auto_send", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "false", "ordinal_position": 15, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "auto_remind", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "true", "ordinal_position": 16, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "status", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "'active'::text", "ordinal_position": 17, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "last_generated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 18, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "next_generation_date", "comment": null, "udt_name": "date", "data_type": "date", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 19, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "subtotal_ht", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": "0", "ordinal_position": 20, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "total_tax", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": "0", "ordinal_position": 21, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "total_ttc", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": "0", "ordinal_position": 22, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 23, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 24, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "Templates for automatically generating recurring invoices", "indexes": [ { "name": "idx_recurring_invoices_status", "method": "btree", "columns": [ "status" ], "is_unique": false, "definition": "CREATE INDEX idx_recurring_invoices_status ON public.recurring_invoices USING btree (status)", "is_primary": false, "size_bytes": 8192 }, { "name": "idx_recurring_invoices_next_date", "method": "btree", "columns": [ "next_generation_date" ], "is_unique": false, "definition": "CREATE INDEX idx_recurring_invoices_next_date ON public.recurring_invoices USING btree (next_generation_date)", "is_primary": false, "size_bytes": 8192 }, { "name": "idx_recurring_invoices_user", "method": "btree", "columns": [ "user_id" ], "is_unique": false, "definition": "CREATE INDEX idx_recurring_invoices_user ON public.recurring_invoices USING btree (user_id)", "is_primary": false, "size_bytes": 8192 }, { "name": "idx_recurring_invoices_client", "method": "btree", "columns": [ "client_id" ], "is_unique": false, "definition": "CREATE INDEX idx_recurring_invoices_client ON public.recurring_invoices USING btree (client_id)", "is_primary": false, "size_bytes": 8192 }, { "name": "recurring_invoices_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX recurring_invoices_pkey ON public.recurring_invoices USING btree (id)", "is_primary": true, "size_bytes": 8192 } ], "policies": [ { "name": "Users can manage their recurring invoices", "qual": "(auth.uid() = user_id)", "roles": [ "public" ], "command": "ALL", "permissive": "PERMISSIVE", "with_check": null } ], "triggers": [ { "name": "update_recurring_invoices_updated_at", "event": "UPDATE", "timing": "BEFORE", "condition": null, "statement": "EXECUTE FUNCTION update_updated_at_column()", "orientation": "ROW" }, { "name": "set_next_generation_date", "event": "INSERT", "timing": "BEFORE", "condition": null, "statement": "EXECUTE FUNCTION update_next_generation_date()", "orientation": "ROW" }, { "name": "set_next_generation_date", "event": "UPDATE", "timing": "BEFORE", "condition": null, "statement": "EXECUTE FUNCTION update_next_generation_date()", "orientation": "ROW" } ], "row_count": -1, "size_bytes": 49152, "primary_key": { "columns": [ "id" ], "constraint_name": "recurring_invoices_pkey" }, "foreign_keys": [ { "columns": [ "client_id" ], "delete_rule": "CASCADE", "update_rule": "NO ACTION", "match_option": "NONE", "constraint_name": "recurring_invoices_client_id_fkey", "referenced_table": "clients", "referenced_schema": "public", "referenced_columns": [ "id" ] } ], "check_constraints": [ { "check_clause": "client_id IS NOT NULL", "constraint_name": "2200_17699_3_not_null" }, { "check_clause": "template_name IS NOT NULL", "constraint_name": "2200_17699_4_not_null" }, { "check_clause": "frequency IS NOT NULL", "constraint_name": "2200_17699_10_not_null" }, { "check_clause": "start_date IS NOT NULL", "constraint_name": "2200_17699_12_not_null" }, { "check_clause": "(status = ANY (ARRAY['active'::text, 'paused'::text, 'completed'::text, 'cancelled'::text]))", "constraint_name": "recurring_invoices_status_check" }, { "check_clause": "(frequency = ANY (ARRAY['daily'::text, 'weekly'::text, 'biweekly'::text, 'monthly'::text, 'quarterly'::text, 'yearly'::text]))", "constraint_name": "recurring_invoices_frequency_check" }, { "check_clause": "id IS NOT NULL", "constraint_name": "2200_17699_1_not_null" }, { "check_clause": "user_id IS NOT NULL", "constraint_name": "2200_17699_2_not_null" } ], "unique_constraints": [] }, { "rls": { "rls_forced": false, "rls_enabled": true }, "name": "signatures", "type": "BASE TABLE", "grants": [ { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "uuid_generate_v4()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "user_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "document_type", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "document_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "signature_data", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "signature_method", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "'drawn'::text", "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "signer_name", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "signer_email", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 8, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "signer_ip_address", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 9, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "signed_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 10, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "device_info", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 11, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "location_data", "comment": null, "udt_name": "jsonb", "data_type": "jsonb", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 12, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "is_valid", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "true", "ordinal_position": 13, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "invalidated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 14, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "invalidation_reason", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 15, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 16, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 17, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "Stores e-signatures for quotes and invoices with full audit trail", "indexes": [ { "name": "idx_signatures_user", "method": "btree", "columns": [ "user_id" ], "is_unique": false, "definition": "CREATE INDEX idx_signatures_user ON public.signatures USING btree (user_id)", "is_primary": false, "size_bytes": 8192 }, { "name": "idx_signatures_document", "method": "btree", "columns": [ "document_type", "document_id" ], "is_unique": false, "definition": "CREATE INDEX idx_signatures_document ON public.signatures USING btree (document_type, document_id)", "is_primary": false, "size_bytes": 8192 }, { "name": "signatures_document_type_document_id_key", "method": "btree", "columns": [ "document_type", "document_id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX signatures_document_type_document_id_key ON public.signatures USING btree (document_type, document_id)", "is_primary": false, "size_bytes": 8192 }, { "name": "signatures_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX signatures_pkey ON public.signatures USING btree (id)", "is_primary": true, "size_bytes": 8192 }, { "name": "idx_signatures_signed_at", "method": "btree", "columns": [ "signed_at" ], "is_unique": false, "definition": "CREATE INDEX idx_signatures_signed_at ON public.signatures USING btree (signed_at)", "is_primary": false, "size_bytes": 8192 } ], "policies": [ { "name": "Users can create signatures for their documents", "qual": null, "roles": [ "public" ], "command": "INSERT", "permissive": "PERMISSIVE", "with_check": "(auth.uid() = user_id)" }, { "name": "Users can view their own signatures", "qual": "(auth.uid() = user_id)", "roles": [ "public" ], "command": "SELECT", "permissive": "PERMISSIVE", "with_check": null }, { "name": "Users can update their own signatures", "qual": "(auth.uid() = user_id)", "roles": [ "public" ], "command": "UPDATE", "permissive": "PERMISSIVE", "with_check": null } ], "triggers": [ { "name": "update_signatures_updated_at", "event": "UPDATE", "timing": "BEFORE", "condition": null, "statement": "EXECUTE FUNCTION update_updated_at_column()", "orientation": "ROW" } ], "row_count": -1, "size_bytes": 49152, "primary_key": { "columns": [ "id" ], "constraint_name": "signatures_pkey" }, "foreign_keys": [], "check_constraints": [ { "check_clause": "user_id IS NOT NULL", "constraint_name": "2200_17677_2_not_null" }, { "check_clause": "id IS NOT NULL", "constraint_name": "2200_17677_1_not_null" }, { "check_clause": "signed_at IS NOT NULL", "constraint_name": "2200_17677_10_not_null" }, { "check_clause": "(document_type = ANY (ARRAY['quote'::text, 'invoice'::text]))", "constraint_name": "signatures_document_type_check" }, { "check_clause": "(signature_method = ANY (ARRAY['drawn'::text, 'uploaded'::text, 'typed'::text]))", "constraint_name": "signatures_signature_method_check" }, { "check_clause": "signer_name IS NOT NULL", "constraint_name": "2200_17677_7_not_null" }, { "check_clause": "signature_data IS NOT NULL", "constraint_name": "2200_17677_5_not_null" }, { "check_clause": "document_id IS NOT NULL", "constraint_name": "2200_17677_4_not_null" }, { "check_clause": "document_type IS NOT NULL", "constraint_name": "2200_17677_3_not_null" } ], "unique_constraints": [ { "columns": [ "document_type", "document_id" ], "constraint_name": "signatures_document_type_document_id_key" } ] }, { "rls": { "rls_forced": false, "rls_enabled": true }, "name": "supplier_products", "type": "BASE TABLE", "grants": [ { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "uuid_generate_v4()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "supplier", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "supplier_product_id", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "reference", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "name", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "description", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "category", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "subcategory", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 8, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "product_type", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 9, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "price", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 10, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "price_unit", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 11, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "vat_rate", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": "20.0", "ordinal_position": 12, "numeric_precision": 5, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "in_stock", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "true", "ordinal_position": 13, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "stock_level", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 14, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "brand", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 15, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "specifications", "comment": null, "udt_name": "jsonb", "data_type": "jsonb", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 16, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "image_url", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 17, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "product_url", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 18, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "diameter_mm", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 19, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "length_m", "comment": null, "udt_name": "numeric", "data_type": "numeric", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 2, "column_default": null, "ordinal_position": 20, "numeric_precision": 10, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "material", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 21, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "last_scraped_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 22, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "scraper_version", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 23, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "is_active", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "true", "ordinal_position": 24, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 25, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 26, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "Stores product catalog data scraped from suppliers (Point P, Cedeo, etc.)", "indexes": [ { "name": "idx_supplier_products_description_search", "method": "gin", "columns": null, "is_unique": false, "definition": "CREATE INDEX idx_supplier_products_description_search ON public.supplier_products USING gin (to_tsvector('french'::regconfig, COALESCE(description, ''::text)))", "is_primary": false, "size_bytes": 24576 }, { "name": "supplier_products_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX supplier_products_pkey ON public.supplier_products USING btree (id)", "is_primary": true, "size_bytes": 16384 }, { "name": "supplier_products_supplier_reference_key", "method": "btree", "columns": [ "supplier", "reference" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX supplier_products_supplier_reference_key ON public.supplier_products USING btree (supplier, reference)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_supplier_products_supplier", "method": "btree", "columns": [ "supplier" ], "is_unique": false, "definition": "CREATE INDEX idx_supplier_products_supplier ON public.supplier_products USING btree (supplier)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_supplier_products_category", "method": "btree", "columns": [ "category" ], "is_unique": false, "definition": "CREATE INDEX idx_supplier_products_category ON public.supplier_products USING btree (category)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_supplier_products_subcategory", "method": "btree", "columns": [ "subcategory" ], "is_unique": false, "definition": "CREATE INDEX idx_supplier_products_subcategory ON public.supplier_products USING btree (subcategory)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_supplier_products_product_type", "method": "btree", "columns": [ "product_type" ], "is_unique": false, "definition": "CREATE INDEX idx_supplier_products_product_type ON public.supplier_products USING btree (product_type)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_supplier_products_price", "method": "btree", "columns": [ "price" ], "is_unique": false, "definition": "CREATE INDEX idx_supplier_products_price ON public.supplier_products USING btree (price)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_supplier_products_in_stock", "method": "btree", "columns": [ "in_stock" ], "is_unique": false, "definition": "CREATE INDEX idx_supplier_products_in_stock ON public.supplier_products USING btree (in_stock)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_supplier_products_supplier_category", "method": "btree", "columns": [ "supplier", "category" ], "is_unique": false, "definition": "CREATE INDEX idx_supplier_products_supplier_category ON public.supplier_products USING btree (supplier, category)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_supplier_products_supplier_stock", "method": "btree", "columns": [ "supplier", "in_stock" ], "is_unique": false, "definition": "CREATE INDEX idx_supplier_products_supplier_stock ON public.supplier_products USING btree (supplier, in_stock)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_supplier_products_name_search", "method": "gin", "columns": null, "is_unique": false, "definition": "CREATE INDEX idx_supplier_products_name_search ON public.supplier_products USING gin (to_tsvector('french'::regconfig, name))", "is_primary": false, "size_bytes": 24576 } ], "policies": [ { "name": "Service role can update supplier products", "qual": "((auth.jwt() ->> 'role'::text) = 'service_role'::text)", "roles": [ "public" ], "command": "UPDATE", "permissive": "PERMISSIVE", "with_check": "((auth.jwt() ->> 'role'::text) = 'service_role'::text)" }, { "name": "Service role can insert supplier products", "qual": null, "roles": [ "public" ], "command": "INSERT", "permissive": "PERMISSIVE", "with_check": "((auth.jwt() ->> 'role'::text) = 'service_role'::text)" }, { "name": "Anyone can read supplier products", "qual": "true", "roles": [ "public" ], "command": "SELECT", "permissive": "PERMISSIVE", "with_check": null } ], "triggers": [ { "name": "update_supplier_products_updated_at", "event": "UPDATE", "timing": "BEFORE", "condition": null, "statement": "EXECUTE FUNCTION update_updated_at_column()", "orientation": "ROW" } ], "row_count": -1, "size_bytes": 229376, "primary_key": { "columns": [ "id" ], "constraint_name": "supplier_products_pkey" }, "foreign_keys": [], "check_constraints": [ { "check_clause": "name IS NOT NULL", "constraint_name": "2200_17660_5_not_null" }, { "check_clause": "reference IS NOT NULL", "constraint_name": "2200_17660_4_not_null" }, { "check_clause": "id IS NOT NULL", "constraint_name": "2200_17660_1_not_null" }, { "check_clause": "supplier IS NOT NULL", "constraint_name": "2200_17660_2_not_null" }, { "check_clause": "(supplier = ANY (ARRAY['point_p'::text, 'cedeo'::text, 'leroy_merlin'::text, 'castorama'::text]))", "constraint_name": "supplier_products_supplier_check" } ], "unique_constraints": [ { "columns": [ "supplier", "reference" ], "constraint_name": "supplier_products_supplier_reference_key" } ] }, { "rls": { "rls_forced": false, "rls_enabled": true }, "name": "templates", "type": "BASE TABLE", "grants": [ { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "authenticated", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "service_role", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "postgres", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "anon", "grantor": "postgres", "is_grantable": "NO", "privilege_type": "DELETE" } ], "schema": "public", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "gen_random_uuid()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "user_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "template_name", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "template_type", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "'quote'::text", "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "category", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "line_items", "comment": null, "udt_name": "jsonb", "data_type": "jsonb", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "terms_conditions", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "is_system_template", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "false", "ordinal_position": 8, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "times_used", "comment": null, "udt_name": "int4", "data_type": "integer", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": 0, "column_default": "0", "ordinal_position": 9, "numeric_precision": 32, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "last_used", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 10, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 11, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 12, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "Contains 50+ system plumbing templates covering all common French plumbing jobs, ready to use for quotes", "indexes": [ { "name": "idx_templates_template_type", "method": "btree", "columns": [ "template_type" ], "is_unique": false, "definition": "CREATE INDEX idx_templates_template_type ON public.templates USING btree (template_type)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_templates_category", "method": "btree", "columns": [ "category" ], "is_unique": false, "definition": "CREATE INDEX idx_templates_category ON public.templates USING btree (category)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_templates_is_system", "method": "btree", "columns": [ "is_system_template" ], "is_unique": false, "definition": "CREATE INDEX idx_templates_is_system ON public.templates USING btree (is_system_template)", "is_primary": false, "size_bytes": 16384 }, { "name": "templates_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX templates_pkey ON public.templates USING btree (id)", "is_primary": true, "size_bytes": 16384 }, { "name": "idx_templates_user_id", "method": "btree", "columns": [ "user_id" ], "is_unique": false, "definition": "CREATE INDEX idx_templates_user_id ON public.templates USING btree (user_id)", "is_primary": false, "size_bytes": 16384 }, { "name": "idx_templates_user_system", "method": "btree", "columns": [ "user_id", "is_system_template" ], "is_unique": false, "definition": "CREATE INDEX idx_templates_user_system ON public.templates USING btree (user_id, is_system_template)", "is_primary": false, "size_bytes": 16384 } ], "policies": [ { "name": "templates_insert_policy", "qual": null, "roles": [ "public" ], "command": "INSERT", "permissive": "PERMISSIVE", "with_check": "((auth.uid() = user_id) AND (is_system_template = false))" }, { "name": "templates_update_policy", "qual": "((auth.uid() = user_id) AND (is_system_template = false))", "roles": [ "public" ], "command": "UPDATE", "permissive": "PERMISSIVE", "with_check": null }, { "name": "templates_delete_policy", "qual": "((auth.uid() = user_id) AND (is_system_template = false))", "roles": [ "public" ], "command": "DELETE", "permissive": "PERMISSIVE", "with_check": null }, { "name": "templates_select_policy", "qual": "((auth.uid() = user_id) OR (is_system_template = true))", "roles": [ "public" ], "command": "SELECT", "permissive": "PERMISSIVE", "with_check": null } ], "triggers": [], "row_count": -1, "size_bytes": 204800, "primary_key": { "columns": [ "id" ], "constraint_name": "templates_pkey" }, "foreign_keys": [], "check_constraints": [ { "check_clause": "id IS NOT NULL", "constraint_name": "2200_18226_1_not_null" }, { "check_clause": "template_name IS NOT NULL", "constraint_name": "2200_18226_3_not_null" } ], "unique_constraints": [] }, { "rls": { "rls_forced": false, "rls_enabled": false }, "name": "messages", "type": "BASE TABLE", "grants": [ { "grantee": "anon", "grantor": "supabase_realtime_admin", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "anon", "grantor": "supabase_realtime_admin", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "anon", "grantor": "supabase_realtime_admin", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "dashboard_user", "grantor": "supabase_realtime_admin", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "dashboard_user", "grantor": "supabase_realtime_admin", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "dashboard_user", "grantor": "supabase_realtime_admin", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "dashboard_user", "grantor": "supabase_realtime_admin", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "dashboard_user", "grantor": "supabase_realtime_admin", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_realtime_admin", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_realtime_admin", "is_grantable": "YES", "privilege_type": "SELECT" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_realtime_admin", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_realtime_admin", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_realtime_admin", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_realtime_admin", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_realtime_admin", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "postgres", "grantor": "supabase_realtime_admin", "is_grantable": "YES", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "supabase_realtime_admin", "is_grantable": "YES", "privilege_type": "SELECT" }, { "grantee": "dashboard_user", "grantor": "supabase_realtime_admin", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "supabase_realtime_admin", "is_grantable": "YES", "privilege_type": "UPDATE" }, { "grantee": "dashboard_user", "grantor": "supabase_realtime_admin", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "postgres", "grantor": "supabase_realtime_admin", "is_grantable": "YES", "privilege_type": "TRIGGER" }, { "grantee": "postgres", "grantor": "supabase_realtime_admin", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "supabase_realtime_admin", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "service_role", "grantor": "supabase_realtime_admin", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "service_role", "grantor": "supabase_realtime_admin", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "supabase_realtime_admin", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "authenticated", "grantor": "supabase_realtime_admin", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "authenticated", "grantor": "supabase_realtime_admin", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "supabase_realtime_admin", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "authenticated", "grantor": "supabase_realtime_admin", "is_grantable": "NO", "privilege_type": "INSERT" } ], "schema": "realtime", "columns": [ { "name": "topic", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "extension", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "payload", "comment": null, "udt_name": "jsonb", "data_type": "jsonb", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "event", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "private", "comment": null, "udt_name": "bool", "data_type": "boolean", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "false", "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamp", "data_type": "timestamp without time zone", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 8, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "inserted_at", "comment": null, "udt_name": "timestamp", "data_type": "timestamp without time zone", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "now()", "ordinal_position": 9, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "gen_random_uuid()", "ordinal_position": 10, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": null, "indexes": [ { "name": "messages_inserted_at_topic_index", "method": "btree", "columns": [ "inserted_at", "topic" ], "is_unique": false, "definition": "CREATE INDEX messages_inserted_at_topic_index ON ONLY realtime.messages USING btree (inserted_at DESC, topic) WHERE ((extension = 'broadcast'::text) AND (private IS TRUE))", "is_primary": false, "size_bytes": 0 }, { "name": "messages_pkey", "method": "btree", "columns": [ "id", "inserted_at" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX messages_pkey ON ONLY realtime.messages USING btree (id, inserted_at)", "is_primary": true, "size_bytes": 0 } ], "policies": [], "triggers": [], "row_count": -1, "size_bytes": 0, "primary_key": { "columns": [ "id", "inserted_at" ], "constraint_name": "messages_pkey" }, "foreign_keys": [], "check_constraints": [ { "check_clause": "id IS NOT NULL", "constraint_name": "16605_17434_10_not_null" }, { "check_clause": "updated_at IS NOT NULL", "constraint_name": "16605_17434_8_not_null" }, { "check_clause": "extension IS NOT NULL", "constraint_name": "16605_17434_4_not_null" }, { "check_clause": "topic IS NOT NULL", "constraint_name": "16605_17434_3_not_null" }, { "check_clause": "inserted_at IS NOT NULL", "constraint_name": "16605_17434_9_not_null" } ], "unique_constraints": [] }, { "rls": { "rls_forced": false, "rls_enabled": false }, "name": "schema_migrations", "type": "BASE TABLE", "grants": [ { "grantee": "authenticated", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "anon", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "service_role", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "SELECT" } ], "schema": "realtime", "columns": [ { "name": "version", "comment": null, "udt_name": "int8", "data_type": "bigint", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": 0, "column_default": null, "ordinal_position": 1, "numeric_precision": 64, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "inserted_at", "comment": null, "udt_name": "timestamp", "data_type": "timestamp without time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": null, "indexes": [ { "name": "schema_migrations_pkey", "method": "btree", "columns": [ "version" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX schema_migrations_pkey ON realtime.schema_migrations USING btree (version)", "is_primary": true, "size_bytes": 16384 } ], "policies": [], "triggers": [], "row_count": 64, "size_bytes": 24576, "primary_key": { "columns": [ "version" ], "constraint_name": "schema_migrations_pkey" }, "foreign_keys": [], "check_constraints": [], "unique_constraints": [] }, { "rls": { "rls_forced": false, "rls_enabled": false }, "name": "subscription", "type": "BASE TABLE", "grants": [ { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "UPDATE" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "INSERT" }, { "grantee": "service_role", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "authenticated", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "anon", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "TRIGGER" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "REFERENCES" }, { "grantee": "supabase_realtime_admin", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "TRUNCATE" } ], "schema": "realtime", "columns": [ { "name": "id", "comment": null, "udt_name": "int8", "data_type": "bigint", "is_identity": "YES", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": 0, "column_default": null, "ordinal_position": 1, "numeric_precision": 64, "identity_generation": "ALWAYS", "generation_expression": null, "character_maximum_length": null }, { "name": "subscription_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "entity", "comment": null, "udt_name": "regclass", "data_type": "regclass", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "filters", "comment": null, "udt_name": "user_defined_filter", "data_type": "ARRAY", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "'{}'::realtime.user_defined_filter[]", "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "claims", "comment": null, "udt_name": "jsonb", "data_type": "jsonb", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "claims_role", "comment": null, "udt_name": "regrole", "data_type": "regrole", "is_identity": "NO", "is_nullable": "NO", "is_generated": "ALWAYS", "numeric_scale": null, "column_default": null, "ordinal_position": 8, "numeric_precision": null, "identity_generation": null, "generation_expression": "realtime.to_regrole((claims ->> 'role'::text))", "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamp", "data_type": "timestamp without time zone", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "timezone('utc'::text, now())", "ordinal_position": 9, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": null, "indexes": [ { "name": "pk_subscription", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX pk_subscription ON realtime.subscription USING btree (id)", "is_primary": false, "size_bytes": 8192 }, { "name": "subscription_subscription_id_entity_filters_key", "method": "btree", "columns": [ "subscription_id", "entity", "filters" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX subscription_subscription_id_entity_filters_key ON realtime.subscription USING btree (subscription_id, entity, filters)", "is_primary": false, "size_bytes": 8192 }, { "name": "ix_realtime_subscription_entity", "method": "btree", "columns": [ "entity" ], "is_unique": false, "definition": "CREATE INDEX ix_realtime_subscription_entity ON realtime.subscription USING btree (entity)", "is_primary": false, "size_bytes": 8192 } ], "policies": [], "triggers": [ { "name": "tr_check_filters", "event": "INSERT", "timing": "BEFORE", "condition": null, "statement": "EXECUTE FUNCTION realtime.subscription_check_filters()", "orientation": "ROW" }, { "name": "tr_check_filters", "event": "UPDATE", "timing": "BEFORE", "condition": null, "statement": "EXECUTE FUNCTION realtime.subscription_check_filters()", "orientation": "ROW" } ], "row_count": -1, "size_bytes": 32768, "primary_key": { "columns": [ "id" ], "constraint_name": "pk_subscription" }, "foreign_keys": [], "check_constraints": [], "unique_constraints": [] }, { "rls": { "rls_forced": false, "rls_enabled": false }, "name": "decrypted_secrets", "type": "VIEW", "grants": [ { "grantee": "service_role", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "YES", "privilege_type": "SELECT" } ], "schema": "vault", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "name", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "description", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "secret", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "decrypted_secret", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "key_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "nonce", "comment": null, "udt_name": "bytea", "data_type": "bytea", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 8, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 9, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": null, "indexes": [], "policies": [], "triggers": [], "row_count": -1, "size_bytes": 0, "primary_key": null, "foreign_keys": [], "check_constraints": [], "unique_constraints": [] }, { "rls": { "rls_forced": false, "rls_enabled": false }, "name": "secrets", "type": "BASE TABLE", "grants": [ { "grantee": "service_role", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "DELETE" }, { "grantee": "service_role", "grantor": "supabase_admin", "is_grantable": "NO", "privilege_type": "SELECT" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "YES", "privilege_type": "REFERENCES" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "YES", "privilege_type": "TRUNCATE" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "YES", "privilege_type": "DELETE" }, { "grantee": "postgres", "grantor": "supabase_admin", "is_grantable": "YES", "privilege_type": "SELECT" } ], "schema": "vault", "columns": [ { "name": "id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "gen_random_uuid()", "ordinal_position": 1, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "name", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 2, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "description", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "''::text", "ordinal_position": 3, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "secret", "comment": null, "udt_name": "text", "data_type": "text", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 4, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "key_id", "comment": null, "udt_name": "uuid", "data_type": "uuid", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": null, "ordinal_position": 5, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "nonce", "comment": null, "udt_name": "bytea", "data_type": "bytea", "is_identity": "NO", "is_nullable": "YES", "is_generated": "NEVER", "numeric_scale": null, "column_default": "vault.crypto_aead_det_noncegen()", "ordinal_position": 6, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "created_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "CURRENT_TIMESTAMP", "ordinal_position": 7, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null }, { "name": "updated_at", "comment": null, "udt_name": "timestamptz", "data_type": "timestamp with time zone", "is_identity": "NO", "is_nullable": "NO", "is_generated": "NEVER", "numeric_scale": null, "column_default": "CURRENT_TIMESTAMP", "ordinal_position": 8, "numeric_precision": null, "identity_generation": null, "generation_expression": null, "character_maximum_length": null } ], "comment": "Table with encrypted secret column for storing sensitive information on disk.", "indexes": [ { "name": "secrets_pkey", "method": "btree", "columns": [ "id" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX secrets_pkey ON vault.secrets USING btree (id)", "is_primary": true, "size_bytes": 8192 }, { "name": "secrets_name_idx", "method": "btree", "columns": [ "name" ], "is_unique": true, "definition": "CREATE UNIQUE INDEX secrets_name_idx ON vault.secrets USING btree (name) WHERE (name IS NOT NULL)", "is_primary": false, "size_bytes": 8192 } ], "policies": [], "triggers": [], "row_count": -1, "size_bytes": 24576, "primary_key": { "columns": [ "id" ], "constraint_name": "secrets_pkey" }, "foreign_keys": [], "check_constraints": [], "unique_constraints": [] } ], "schemas": [ { "name": "public", "owner": "pg_database_owner", "comment": "standard public schema" }, { "name": "pg_toast_temp_19", "owner": "supabase_admin", "comment": null }, { "name": "pg_temp_19", "owner": "supabase_admin", "comment": null }, { "name": "pg_toast_temp_21", "owner": "supabase_admin", "comment": null }, { "name": "pg_temp_21", "owner": "supabase_admin", "comment": null }, { "name": "pg_toast_temp_51", "owner": "supabase_admin", "comment": null }, { "name": "graphql", "owner": "supabase_admin", "comment": null }, { "name": "graphql_public", "owner": "supabase_admin", "comment": null }, { "name": "pg_temp_51", "owner": "supabase_admin", "comment": null }, { "name": "vault", "owner": "supabase_admin", "comment": null }, { "name": "pg_toast_temp_25", "owner": "supabase_admin", "comment": null }, { "name": "pg_temp_25", "owner": "supabase_admin", "comment": null }, { "name": "pg_toast_temp_0", "owner": "supabase_admin", "comment": null }, { "name": "pg_temp_0", "owner": "supabase_admin", "comment": null }, { "name": "pg_toast_temp_1", "owner": "supabase_admin", "comment": null }, { "name": "pg_temp_1", "owner": "supabase_admin", "comment": null }, { "name": "pg_toast_temp_30", "owner": "supabase_admin", "comment": null }, { "name": "pg_temp_30", "owner": "supabase_admin", "comment": null }, { "name": "pg_toast_temp_28", "owner": "supabase_admin", "comment": null }, { "name": "pg_temp_28", "owner": "supabase_admin", "comment": null }, { "name": "pg_toast_temp_14", "owner": "supabase_admin", "comment": null }, { "name": "pg_temp_14", "owner": "supabase_admin", "comment": null }, { "name": "pg_toast_temp_53", "owner": "supabase_admin", "comment": null }, { "name": "pg_temp_53", "owner": "supabase_admin", "comment": null }, { "name": "pg_toast_temp_9", "owner": "supabase_admin", "comment": null }, { "name": "pg_temp_9", "owner": "supabase_admin", "comment": null }, { "name": "realtime", "owner": "supabase_admin", "comment": null }, { "name": "pg_toast", "owner": "supabase_admin", "comment": "reserved schema for TOAST tables" }, { "name": "pgbouncer", "owner": "pgbouncer", "comment": null } ], "database": { "name": "postgres", "ctype": "en_US.UTF-8", "owner": "postgres", "version": "PostgreSQL 17.6 on aarch64-unknown-linux-gnu, compiled by gcc (GCC) 13.2.0, 64-bit", "encoding": "UTF8", "collation": "en_US.UTF-8", "size_bytes": 12807315, "tablespace": "pg_default", "current_user": "postgres", "session_user": "postgres", "current_schema": "public", "connection_limit": -1, "postgres_version": "17.6" }, "functions": [ { "cost": 100, "name": "get_auth", "rows": 1000, "schema": "pgbouncer", "strict": false, "comment": null, "language": "plpgsql", "parallel": "UNSAFE", "arguments": "p_usename text", "definition": "CREATE OR REPLACE FUNCTION pgbouncer.get_auth(p_usename text)\n RETURNS TABLE(username text, password text)\n LANGUAGE plpgsql\n SECURITY DEFINER\nAS $function$\nbegin\n raise debug 'PgBouncer auth request: %', p_usename;\n\n return query\n select \n rolname::text, \n case when rolvaliduntil < now() \n then null \n else rolpassword::text \n end \n from pg_authid \n where rolname=$1 and rolcanlogin;\nend;\n$function$\n", "volatility": "VOLATILE", "return_type": "TABLE(username text, password text)", "returns_set": true, "security_definer": true, "identity_arguments": "p_usename text" }, { "cost": 100, "name": "increment_schema_version", "rows": 0, "schema": "graphql", "strict": false, "comment": null, "language": "plpgsql", "parallel": "UNSAFE", "arguments": "", "definition": "CREATE OR REPLACE FUNCTION graphql.increment_schema_version()\n RETURNS event_trigger\n LANGUAGE plpgsql\n SECURITY DEFINER\nAS $function$\nbegin\n perform pg_catalog.nextval('graphql.seq_schema_version');\nend;\n$function$\n", "volatility": "VOLATILE", "return_type": "event_trigger", "returns_set": false, "security_definer": true, "identity_arguments": "" }, { "cost": 1, "name": "crypto_aead_det_noncegen", "rows": 0, "schema": "vault", "strict": false, "comment": null, "language": "c", "parallel": "UNSAFE", "arguments": "", "definition": "CREATE OR REPLACE FUNCTION vault.crypto_aead_det_noncegen()\n RETURNS bytea\n LANGUAGE c\n IMMUTABLE\nAS '$libdir/supabase_vault', $function$pgsodium_crypto_aead_det_noncegen$function$\n", "volatility": "IMMUTABLE", "return_type": "bytea", "returns_set": false, "security_definer": false, "identity_arguments": "" }, { "cost": 100, "name": "get_schema_version", "rows": 0, "schema": "graphql", "strict": false, "comment": null, "language": "sql", "parallel": "UNSAFE", "arguments": "", "definition": "CREATE OR REPLACE FUNCTION graphql.get_schema_version()\n RETURNS integer\n LANGUAGE sql\n SECURITY DEFINER\nAS $function$\n select last_value from graphql.seq_schema_version;\n$function$\n", "volatility": "VOLATILE", "return_type": "integer", "returns_set": false, "security_definer": true, "identity_arguments": "" }, { "cost": 1, "name": "internal_resolve", "rows": 0, "schema": "graphql", "strict": false, "comment": null, "language": "c", "parallel": "UNSAFE", "arguments": "query text, variables jsonb DEFAULT '{}'::jsonb, "operationName" text DEFAULT NULL::text, extensions jsonb DEFAULT NULL::jsonb", "definition": "CREATE OR REPLACE FUNCTION graphql.internal_resolve(query text, variables jsonb DEFAULT '{}'::jsonb, "operationName" text DEFAULT NULL::text, extensions jsonb DEFAULT NULL::jsonb)\n RETURNS jsonb\n LANGUAGE c\nAS '$libdir/pg_graphql', $function$resolve_wrapper$function$\n", "volatility": "VOLATILE", "return_type": "jsonb", "returns_set": false, "security_definer": false, "identity_arguments": "query text, variables jsonb, "operationName" text, extensions jsonb" }, { "cost": 100, "name": "resolve", "rows": 0, "schema": "graphql", "strict": false, "comment": null, "language": "plpgsql", "parallel": "UNSAFE", "arguments": "query text, variables jsonb DEFAULT '{}'::jsonb, "operationName" text DEFAULT NULL::text, extensions jsonb DEFAULT NULL::jsonb", "definition": "CREATE OR REPLACE FUNCTION graphql.resolve(query text, variables jsonb DEFAULT '{}'::jsonb, "operationName" text DEFAULT NULL::text, extensions jsonb DEFAULT NULL::jsonb)\n RETURNS jsonb\n LANGUAGE plpgsql\nAS $function$\ndeclare\n res jsonb;\n message_text text;\nbegin\n begin\n select graphql.internal_resolve("query" := "query",\n "variables" := "variables",\n "operationName" := "operationName",\n "extensions" := "extensions") into res;\n return res;\n exception\n when others then\n get stacked diagnostics message_text = message_text;\n return\n jsonb_build_object('data', null,\n 'errors', jsonb_build_array(jsonb_build_object('message', message_text)));\n end;\nend;\n$function$\n", "volatility": "VOLATILE", "return_type": "jsonb", "returns_set": false, "security_definer": false, "identity_arguments": "query text, variables jsonb, "operationName" text, extensions jsonb" }, { "cost": 1, "name": "crypto_aead_det_encrypt", "rows": 0, "schema": "vault", "strict": false, "comment": null, "language": "c", "parallel": "UNSAFE", "arguments": "message bytea, additional bytea, key_id bigint, context bytea DEFAULT '\x7067736f6469756d'::bytea, nonce bytea DEFAULT NULL::bytea", "definition": "CREATE OR REPLACE FUNCTION vault.crypto_aead_det_encrypt(message bytea, additional bytea, key_id bigint, context bytea DEFAULT '\x7067736f6469756d'::bytea, nonce bytea DEFAULT NULL::bytea)\n RETURNS bytea\n LANGUAGE c\n IMMUTABLE\nAS '$libdir/supabase_vault', $function$pgsodium_crypto_aead_det_encrypt_by_id$function$\n", "volatility": "IMMUTABLE", "return_type": "bytea", "returns_set": false, "security_definer": false, "identity_arguments": "message bytea, additional bytea, key_id bigint, context bytea, nonce bytea" }, { "cost": 100, "name": "create_secret", "rows": 0, "schema": "vault", "strict": false, "comment": null, "language": "plpgsql", "parallel": "UNSAFE", "arguments": "new_secret text, new_name text DEFAULT NULL::text, new_description text DEFAULT ''::text, new_key_id uuid DEFAULT NULL::uuid", "definition": "CREATE OR REPLACE FUNCTION vault.create_secret(new_secret text, new_name text DEFAULT NULL::text, new_description text DEFAULT ''::text, new_key_id uuid DEFAULT NULL::uuid)\n RETURNS uuid\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path TO ''\nAS $function$\nDECLARE\n rec record;\nBEGIN\n INSERT INTO vault.secrets (secret, name, description)\n VALUES (\n new_secret,\n new_name,\n new_description\n )\n RETURNING * INTO rec;\n UPDATE vault.secrets s\n SET secret = encode(vault.crypto_aead_det_encrypt(\n message := convert_to(rec.secret, 'utf8'),\n additional := convert_to(s.id::text, 'utf8'),\n key_id := 0,\n context := 'pgsodium'::bytea,\n nonce := rec.nonce\n ), 'base64')\n WHERE id = rec.id;\n RETURN rec.id;\nEND\n$function$\n", "volatility": "VOLATILE", "return_type": "uuid", "returns_set": false, "security_definer": true, "identity_arguments": "new_secret text, new_name text, new_description text, new_key_id uuid" }, { "cost": 1, "name": "crypto_aead_det_decrypt", "rows": 0, "schema": "vault", "strict": false, "comment": null, "language": "c", "parallel": "UNSAFE", "arguments": "message bytea, additional bytea, key_id bigint, context bytea DEFAULT '\x7067736f6469756d'::bytea, nonce bytea DEFAULT NULL::bytea", "definition": "CREATE OR REPLACE FUNCTION vault.crypto_aead_det_decrypt(message bytea, additional bytea, key_id bigint, context bytea DEFAULT '\x7067736f6469756d'::bytea, nonce bytea DEFAULT NULL::bytea)\n RETURNS bytea\n LANGUAGE c\n IMMUTABLE\nAS '$libdir/supabase_vault', $function$pgsodium_crypto_aead_det_decrypt_by_id$function$\n", "volatility": "IMMUTABLE", "return_type": "bytea", "returns_set": false, "security_definer": false, "identity_arguments": "message bytea, additional bytea, key_id bigint, context bytea, nonce bytea" }, { "cost": 100, "name": "update_secret", "rows": 0, "schema": "vault", "strict": false, "comment": null, "language": "plpgsql", "parallel": "UNSAFE", "arguments": "secret_id uuid, new_secret text DEFAULT NULL::text, new_name text DEFAULT NULL::text, new_description text DEFAULT NULL::text, new_key_id uuid DEFAULT NULL::uuid", "definition": "CREATE OR REPLACE FUNCTION vault.update_secret(secret_id uuid, new_secret text DEFAULT NULL::text, new_name text DEFAULT NULL::text, new_description text DEFAULT NULL::text, new_key_id uuid DEFAULT NULL::uuid)\n RETURNS void\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path TO ''\nAS $function$\nDECLARE\n decrypted_secret text := (SELECT decrypted_secret FROM vault.decrypted_secrets WHERE id = secret_id);\nBEGIN\n UPDATE vault.secrets s\n SET\n secret = CASE WHEN new_secret IS NULL THEN s.secret\n ELSE encode(vault.crypto_aead_det_encrypt(\n message := convert_to(new_secret, 'utf8'),\n additional := convert_to(s.id::text, 'utf8'),\n key_id := 0,\n context := 'pgsodium'::bytea,\n nonce := s.nonce\n ), 'base64') END,\n name = coalesce(new_name, s.name),\n description = coalesce(new_description, s.description),\n updated_at = now()\n WHERE s.id = secret_id;\nEND\n$function$\n", "volatility": "VOLATILE", "return_type": "void", "returns_set": false, "security_definer": true, "identity_arguments": "secret_id uuid, new_secret text, new_name text, new_description text, new_key_id uuid" }, { "cost": 100, "name": "graphql", "rows": 0, "schema": "graphql_public", "strict": false, "comment": null, "language": "sql", "parallel": "UNSAFE", "arguments": ""operationName" text DEFAULT NULL::text, query text DEFAULT NULL::text, variables jsonb DEFAULT NULL::jsonb, extensions jsonb DEFAULT NULL::jsonb", "definition": "CREATE OR REPLACE FUNCTION graphql_public.graphql("operationName" text DEFAULT NULL::text, query text DEFAULT NULL::text, variables jsonb DEFAULT NULL::jsonb, extensions jsonb DEFAULT NULL::jsonb)\n RETURNS jsonb\n LANGUAGE sql\nAS $function$\n select graphql.resolve(\n query := query,\n variables := coalesce(variables, '{}'),\n "operationName" := "operationName",\n extensions := extensions\n );\n $function$\n", "volatility": "VOLATILE", "return_type": "jsonb", "returns_set": false, "security_definer": false, "identity_arguments": ""operationName" text, query text, variables jsonb, extensions jsonb" }, { "cost": 100, "name": "exception", "rows": 0, "schema": "graphql", "strict": false, "comment": null, "language": "plpgsql", "parallel": "UNSAFE", "arguments": "message text", "definition": "CREATE OR REPLACE FUNCTION graphql.exception(message text)\n RETURNS text\n LANGUAGE plpgsql\nAS $function$\nbegin\n raise exception using errcode='22000', message=message;\nend;\n$function$\n", "volatility": "VOLATILE", "return_type": "text", "returns_set": false, "security_definer": false, "identity_arguments": "message text" }, { "cost": 100, "name": "comment_directive", "rows": 0, "schema": "graphql", "strict": false, "comment": null, "language": "sql", "parallel": "UNSAFE", "arguments": "comment text", "definition": "CREATE OR REPLACE FUNCTION graphql.comment_directive(comment text)\n RETURNS jsonb\n LANGUAGE sql\n IMMUTABLE\nAS $function$\n /*\n comment on column public.account.name is '@graphql.name: myField'\n */\n select\n coalesce(\n (\n regexp_match(\n comment,\n '@graphql\((.+)\)'\n )\n )[1]::jsonb,\n jsonb_build_object()\n )\n$function$\n", "volatility": "IMMUTABLE", "return_type": "jsonb", "returns_set": false, "security_definer": false, "identity_arguments": "comment text" }, { "cost": 100, "name": "quote_wal2json", "rows": 0, "schema": "realtime", "strict": true, "comment": null, "language": "sql", "parallel": "UNSAFE", "arguments": "entity regclass", "definition": "CREATE OR REPLACE FUNCTION realtime.quote_wal2json(entity regclass)\n RETURNS text\n LANGUAGE sql\n IMMUTABLE STRICT\nAS $function$\n select\n (\n select string_agg('' || ch,'')\n from unnest(string_to_array(nsp.nspname::text, null)) with ordinality x(ch, idx)\n where\n not (x.idx = 1 and x.ch = '"')\n and not (\n x.idx = array_length(string_to_array(nsp.nspname::text, null), 1)\n and x.ch = '"'\n )\n )\n || '.'\n || (\n select string_agg('' || ch,'')\n from unnest(string_to_array(pc.relname::text, null)) with ordinality x(ch, idx)\n where\n not (x.idx = 1 and x.ch = '"')\n and not (\n x.idx = array_length(string_to_array(nsp.nspname::text, null), 1)\n and x.ch = '"'\n )\n )\n from\n pg_class pc\n join pg_namespace nsp\n on pc.relnamespace = nsp.oid\n where\n pc.oid = entity\n $function$\n", "volatility": "IMMUTABLE", "return_type": "text", "returns_set": false, "security_definer": false, "identity_arguments": "entity regclass" }, { "cost": 100, "name": "cast", "rows": 0, "schema": "realtime", "strict": false, "comment": null, "language": "plpgsql", "parallel": "UNSAFE", "arguments": "val text, type regtype", "definition": "CREATE OR REPLACE FUNCTION realtime."cast"(val text, type regtype)\n RETURNS jsonb\n LANGUAGE plpgsql\n IMMUTABLE\nAS $function$\n declare\n res jsonb;\n begin\n execute format('select to_jsonb(%L::'|| type::text || ')', val) into res;\n return res;\n end\n $function$\n", "volatility": "IMMUTABLE", "return_type": "jsonb", "returns_set": false, "security_definer": false, "identity_arguments": "val text, type regtype" }, { "cost": 100, "name": "is_visible_through_filters", "rows": 0, "schema": "realtime", "strict": false, "comment": null, "language": "sql", "parallel": "UNSAFE", "arguments": "columns realtime.wal_column[], filters realtime.user_defined_filter[]", "definition": "CREATE OR REPLACE FUNCTION realtime.is_visible_through_filters(columns realtime.wal_column[], filters realtime.user_defined_filter[])\n RETURNS boolean\n LANGUAGE sql\n IMMUTABLE\nAS $function$\n /*\n Should the record be visible (true) or filtered out (false) after filters are applied\n */\n select\n -- Default to allowed when no filters present\n $2 is null -- no filters. this should not happen because subscriptions has a default\n or array_length($2, 1) is null -- array length of an empty array is null\n or bool_and(\n coalesce(\n realtime.check_equality_op(\n op:=f.op,\n type:=coalesce(\n col.type_oid::regtype, -- null when wal2json version <= 2.4\n col.type_name::regtype\n ),\n -- cast jsonb to text\n val_1:=col.value #>> '{}',\n val_2:=f.value\n ),\n false -- if null, filter does not match\n )\n )\n from\n unnest(filters) f\n join unnest(columns) col\n on f.column_name = col.name;\n $function$\n", "volatility": "IMMUTABLE", "return_type": "boolean", "returns_set": false, "security_definer": false, "identity_arguments": "columns realtime.wal_column[], filters realtime.user_defined_filter[]" }, { "cost": 100, "name": "broadcast_changes", "rows": 0, "schema": "realtime", "strict": false, "comment": null, "language": "plpgsql", "parallel": "UNSAFE", "arguments": "topic_name text, event_name text, operation text, table_name text, table_schema text, new record, old record, level text DEFAULT 'ROW'::text", "definition": "CREATE OR REPLACE FUNCTION realtime.broadcast_changes(topic_name text, event_name text, operation text, table_name text, table_schema text, new record, old record, level text DEFAULT 'ROW'::text)\n RETURNS void\n LANGUAGE plpgsql\nAS $function$\nDECLARE\n -- Declare a variable to hold the JSONB representation of the row\n row_data jsonb := '{}'::jsonb;\nBEGIN\n IF level = 'STATEMENT' THEN\n RAISE EXCEPTION 'function can only be triggered for each row, not for each statement';\n END IF;\n -- Check the operation type and handle accordingly\n IF operation = 'INSERT' OR operation = 'UPDATE' OR operation = 'DELETE' THEN\n row_data := jsonb_build_object('old_record', OLD, 'record', NEW, 'operation', operation, 'table', table_name, 'schema', table_schema);\n PERFORM realtime.send (row_data, event_name, topic_name);\n ELSE\n RAISE EXCEPTION 'Unexpected operation type: %', operation;\n END IF;\nEXCEPTION\n WHEN OTHERS THEN\n RAISE EXCEPTION 'Failed to process the row: %', SQLERRM;\nEND;\n\n$function$\n", "volatility": "VOLATILE", "return_type": "void", "returns_set": false, "security_definer": false, "identity_arguments": "topic_name text, event_name text, operation text, table_name text, table_schema text, new record, old record, level text" }, { "cost": 100, "name": "to_regrole", "rows": 0, "schema": "realtime", "strict": false, "comment": null, "language": "sql", "parallel": "UNSAFE", "arguments": "role_name text", "definition": "CREATE OR REPLACE FUNCTION realtime.to_regrole(role_name text)\n RETURNS regrole\n LANGUAGE sql\n IMMUTABLE\nAS $function$ select role_name::regrole $function$\n", "volatility": "IMMUTABLE", "return_type": "regrole", "returns_set": false, "security_definer": false, "identity_arguments": "role_name text" }, { "cost": 100, "name": "build_prepared_statement_sql", "rows": 0, "schema": "realtime", "strict": false, "comment": null, "language": "sql", "parallel": "UNSAFE", "arguments": "prepared_statement_name text, entity regclass, columns realtime.wal_column[]", "definition": "CREATE OR REPLACE FUNCTION realtime.build_prepared_statement_sql(prepared_statement_name text, entity regclass, columns realtime.wal_column[])\n RETURNS text\n LANGUAGE sql\nAS $function$\n /*\n Builds a sql string that, if executed, creates a prepared statement to\n tests retrive a row from entity by its primary key columns.\n Example\n select realtime.build_prepared_statement_sql('public.notes', '{"id"}'::text[], '{"bigint"}'::text[])\n */\n select\n 'prepare ' || prepared_statement_name || ' as\n select\n exists(\n select\n 1\n from\n ' || entity || '\n where\n ' || string_agg(quote_ident(pkc.name) || '=' || quote_nullable(pkc.value #>> '{}') , ' and ') || '\n )'\n from\n unnest(columns) pkc\n where\n pkc.is_pkey\n group by\n entity\n $function$\n", "volatility": "VOLATILE", "return_type": "text", "returns_set": false, "security_definer": false, "identity_arguments": "prepared_statement_name text, entity regclass, columns realtime.wal_column[]" }, { "cost": 100, "name": "apply_rls", "rows": 1000, "schema": "realtime", "strict": false, "comment": null, "language": "plpgsql", "parallel": "UNSAFE", "arguments": "wal jsonb, max_record_bytes integer DEFAULT (1024 * 1024)", "definition": "CREATE OR REPLACE FUNCTION realtime.apply_rls(wal jsonb, max_record_bytes integer DEFAULT (1024 * 1024))\n RETURNS SETOF realtime.wal_rls\n LANGUAGE plpgsql\nAS $function$\ndeclare\n-- Regclass of the table e.g. public.notes\nentity regclass = (quote_ident(wal ->> 'schema') || '.' || quote_ident(wal ->> 'table'))::regclass;\n\n-- I, U, D, T: insert, update ...\naction realtime.action = (\n case wal ->> 'action'\n when 'I' then 'INSERT'\n when 'U' then 'UPDATE'\n when 'D' then 'DELETE'\n else 'ERROR'\n end\n);\n\n-- Is row level security enabled for the table\nis_rls_enabled bool = relrowsecurity from pg_class where oid = entity;\n\nsubscriptions realtime.subscription[] = array_agg(subs)\n from\n realtime.subscription subs\n where\n subs.entity = entity;\n\n-- Subscription vars\nroles regrole[] = array_agg(distinct us.claims_role::text)\n from\n unnest(subscriptions) us;\n\nworking_role regrole;\nclaimed_role regrole;\nclaims jsonb;\n\nsubscription_id uuid;\nsubscription_has_access bool;\nvisible_to_subscription_ids uuid[] = '{}';\n\n-- structured info for wal's columns\ncolumns realtime.wal_column[];\n-- previous identity values for update/delete\nold_columns realtime.wal_column[];\n\nerror_record_exceeds_max_size boolean = octet_length(wal::text) > max_record_bytes;\n\n-- Primary jsonb output for record\noutput jsonb;\n\nbegin\nperform set_config('role', null, true);\n\ncolumns =\n array_agg(\n (\n x->>'name',\n x->>'type',\n x->>'typeoid',\n realtime.cast(\n (x->'value') #>> '{}',\n coalesce(\n (x->>'typeoid')::regtype, -- null when wal2json version <= 2.4\n (x->>'type')::regtype\n )\n ),\n (pks ->> 'name') is not null,\n true\n )::realtime.wal_column\n )\n from\n jsonb_array_elements(wal -> 'columns') x\n left join jsonb_array_elements(wal -> 'pk') pks\n on (x ->> 'name') = (pks ->> 'name');\n\nold_columns =\n array_agg(\n (\n x->>'name',\n x->>'type',\n x->>'typeoid',\n realtime.cast(\n (x->'value') #>> '{}',\n coalesce(\n (x->>'typeoid')::regtype, -- null when wal2json version <= 2.4\n (x->>'type')::regtype\n )\n ),\n (pks ->> 'name') is not null,\n true\n )::realtime.wal_column\n )\n from\n jsonb_array_elements(wal -> 'identity') x\n left join jsonb_array_elements(wal -> 'pk') pks\n on (x ->> 'name') = (pks ->> 'name');\n\nfor working_role in select * from unnest(roles) loop\n\n -- Update is_selectable for columns and old_columns\n columns =\n array_agg(\n (\n c.name,\n c.type_name,\n c.type_oid,\n c.value,\n c.is_pkey,\n pg_catalog.has_column_privilege(working_role, entity, c.name, 'SELECT')\n )::realtime.wal_column\n )\n from\n unnest(columns) c;\n\n old_columns =\n array_agg(\n (\n c.name,\n c.type_name,\n c.type_oid,\n c.value,\n c.is_pkey,\n pg_catalog.has_column_privilege(working_role, entity, c.name, 'SELECT')\n )::realtime.wal_column\n )\n from\n unnest(old_columns) c;\n\n if action <> 'DELETE' and count(1) = 0 from unnest(columns) c where c.is_pkey then\n return next (\n jsonb_build_object(\n 'schema', wal ->> 'schema',\n 'table', wal ->> 'table',\n 'type', action\n ),\n is_rls_enabled,\n -- subscriptions is already filtered by entity\n (select array_agg(s.subscription_id) from unnest(subscriptions) as s where claims_role = working_role),\n array['Error 400: Bad Request, no primary key']\n )::realtime.wal_rls;\n\n -- The claims role does not have SELECT permission to the primary key of entity\n elsif action <> 'DELETE' and sum(c.is_selectable::int) <> count(1) from unnest(columns) c where c.is_pkey then\n return next (\n jsonb_build_object(\n 'schema', wal ->> 'schema',\n 'table', wal ->> 'table',\n 'type', action\n ),\n is_rls_enabled,\n (select array_agg(s.subscription_id) from unnest(subscriptions) as s where claims_role = working_role),\n array['Error 401: Unauthorized']\n )::realtime.wal_rls;\n\n else\n output = jsonb_build_object(\n 'schema', wal ->> 'schema',\n 'table', wal ->> 'table',\n 'type', action,\n 'commit_timestamp', to_char(\n ((wal ->> 'timestamp')::timestamptz at time zone 'utc'),\n 'YYYY-MM-DD"T"HH24:MI:SS.MS"Z"'\n ),\n 'columns', (\n select\n jsonb_agg(\n jsonb_build_object(\n 'name', pa.attname,\n 'type', pt.typname\n )\n order by pa.attnum asc\n )\n from\n pg_attribute pa\n join pg_type pt\n on pa.atttypid = pt.oid\n where\n attrelid = entity\n and attnum > 0\n and pg_catalog.has_column_privilege(working_role, entity_, pa.attname, 'SELECT')\n )\n )\n -- Add "record" key for insert and update\n || case\n when action in ('INSERT', 'UPDATE') then\n jsonb_build_object(\n 'record',\n (\n select\n jsonb_object_agg(\n -- if unchanged toast, get column name and value from old record\n coalesce((c).name, (oc).name),\n case\n when (c).name is null then (oc).value\n else (c).value\n end\n )\n from\n unnest(columns) c\n full outer join unnest(old_columns) oc\n on (c).name = (oc).name\n where\n coalesce((c).is_selectable, (oc).is_selectable)\n and ( not error_record_exceeds_max_size or (octet_length((c).value::text) <= 64))\n )\n )\n else '{}'::jsonb\n end\n -- Add "old_record" key for update and delete\n || case\n when action = 'UPDATE' then\n jsonb_build_object(\n 'old_record',\n (\n select jsonb_object_agg((c).name, (c).value)\n from unnest(old_columns) c\n where\n (c).is_selectable\n and ( not error_record_exceeds_max_size or (octet_length((c).value::text) <= 64))\n )\n )\n when action = 'DELETE' then\n jsonb_build_object(\n 'old_record',\n (\n select jsonb_object_agg((c).name, (c).value)\n from unnest(old_columns) c\n where\n (c).is_selectable\n and ( not error_record_exceeds_max_size or (octet_length((c).value::text) <= 64))\n and ( not is_rls_enabled or (c).is_pkey ) -- if RLS enabled, we can't secure deletes so filter to pkey\n )\n )\n else '{}'::jsonb\n end;\n\n -- Create the prepared statement\n if is_rls_enabled and action <> 'DELETE' then\n if (select 1 from pg_prepared_statements where name = 'walrus_rls_stmt' limit 1) > 0 then\n deallocate walrus_rls_stmt;\n end if;\n execute realtime.build_prepared_statement_sql('walrus_rls_stmt', entity_, columns);\n end if;\n\n visible_to_subscription_ids = '{}';\n\n for subscription_id, claims in (\n select\n subs.subscription_id,\n subs.claims\n from\n unnest(subscriptions) subs\n where\n subs.entity = entity_\n and subs.claims_role = working_role\n and (\n realtime.is_visible_through_filters(columns, subs.filters)\n or (\n action = 'DELETE'\n and realtime.is_visible_through_filters(old_columns, subs.filters)\n )\n )\n ) loop\n\n if not is_rls_enabled or action = 'DELETE' then\n visible_to_subscription_ids = visible_to_subscription_ids || subscription_id;\n else\n -- Check if RLS allows the role to see the record\n perform\n -- Trim leading and trailing quotes from working_role because set_config\n -- doesn't recognize the role as valid if they are included\n set_config('role', trim(both '"' from working_role::text), true),\n set_config('request.jwt.claims', claims::text, true);\n\n execute 'execute walrus_rls_stmt' into subscription_has_access;\n\n if subscription_has_access then\n visible_to_subscription_ids = visible_to_subscription_ids || subscription_id;\n end if;\n end if;\n end loop;\n\n perform set_config('role', null, true);\n\n return next (\n output,\n is_rls_enabled,\n visible_to_subscription_ids,\n case\n when error_record_exceeds_max_size then array['Error 413: Payload Too Large']\n else '{}'\n end\n )::realtime.wal_rls;\n\n end if;\nend loop;\n\nperform set_config('role', null, true);\nend;\n$function$\n", "volatility": "VOLATILE", "return_type": "SETOF realtime.wal_rls", "returns_set": true, "security_definer": false, "identity_arguments": "wal jsonb, max_record_bytes integer" }, { "cost": 100, "name": "check_equality_op", "rows": 0, "schema": "realtime", "strict": false, "comment": null, "language": "plpgsql", "parallel": "UNSAFE", "arguments": "op realtime.equality_op, type_ regtype, val_1 text, val_2 text", "definition": "CREATE OR REPLACE FUNCTION realtime.check_equality_op(op realtime.equality_op, type_ regtype, val_1 text, val_2 text)\n RETURNS boolean\n LANGUAGE plpgsql\n IMMUTABLE\nAS $function$\n /\n Casts val_1 and val_2 as type type_ and check the op condition for truthiness\n /\n declare\n op_symbol text = (\n case\n when op = 'eq' then '='\n when op = 'neq' then '!='\n when op = 'lt' then '<'\n when op = 'lte' then '<='\n when op = 'gt' then '>'\n when op = 'gte' then '>='\n when op = 'in' then '= any'\n else 'UNKNOWN OP'\n end\n );\n res boolean;\n begin\n execute format(\n 'select %L::'|| type_::text || ' ' || op_symbol\n || ' ( %L::'\n || (\n case\n when op = 'in' then type_::text || '[]'\n else type_::text end\n )\n || ')', val_1, val_2) into res;\n return res;\n end;\n $function$\n", "volatility": "IMMUTABLE", "return_type": "boolean", "returns_set": false, "security_definer": false, "identity_arguments": "op realtime.equality_op, type_ regtype, val_1 text, val_2 text" }, { "cost": 100, "name": "list_changes", "rows": 1000, "schema": "realtime", "strict": false, "comment": null, "language": "sql", "parallel": "UNSAFE", "arguments": "publication name, slot_name name, max_changes integer, max_record_bytes integer", "definition": "CREATE OR REPLACE FUNCTION realtime.list_changes(publication name, slot_name name, max_changes integer, max_record_bytes integer)\n RETURNS SETOF realtime.wal_rls\n LANGUAGE sql\n SET log_min_messages TO 'fatal'\nAS $function$\n with pub as (\n select\n concat_ws(\n ',',\n case when bool_or(pubinsert) then 'insert' else null end,\n case when bool_or(pubupdate) then 'update' else null end,\n case when bool_or(pubdelete) then 'delete' else null end\n ) as w2j_actions,\n coalesce(\n string_agg(\n realtime.quote_wal2json(format('%I.%I', schemaname, tablename)::regclass),\n ','\n ) filter (where ppt.tablename is not null and ppt.tablename not like '% %'),\n ''\n ) w2j_add_tables\n from\n pg_publication pp\n left join pg_publication_tables ppt\n on pp.pubname = ppt.pubname\n where\n pp.pubname = publication\n group by\n pp.pubname\n limit 1\n ),\n w2j as (\n select\n x., pub.w2j_add_tables\n from\n pub,\n pg_logical_slot_get_changes(\n slot_name, null, max_changes,\n 'include-pk', 'true',\n 'include-transaction', 'false',\n 'include-timestamp', 'true',\n 'include-type-oids', 'true',\n 'format-version', '2',\n 'actions', pub.w2j_actions,\n 'add-tables', pub.w2j_add_tables\n ) x\n )\n select\n xyz.wal,\n xyz.is_rls_enabled,\n xyz.subscription_ids,\n xyz.errors\n from\n w2j,\n realtime.apply_rls(\n wal := w2j.data::jsonb,\n max_record_bytes := max_record_bytes\n ) xyz(wal, is_rls_enabled, subscription_ids, errors)\n where\n w2j.w2j_add_tables <> ''\n and xyz.subscription_ids[1] is not null\n $function$\n", "volatility": "VOLATILE", "return_type": "SETOF realtime.wal_rls", "returns_set": true, "security_definer": false, "identity_arguments": "publication name, slot_name name, max_changes integer, max_record_bytes integer" }, { "cost": 100, "name": "subscription_check_filters", "rows": 0, "schema": "realtime", "strict": false, "comment": null, "language": "plpgsql", "parallel": "UNSAFE", "arguments": "", "definition": "CREATE OR REPLACE FUNCTION realtime.subscription_check_filters()\n RETURNS trigger\n LANGUAGE plpgsql\nAS $function$\n /\n Validates that the user defined filters for a subscription:\n - refer to valid columns that the claimed role may access\n - values are coercable to the correct column type\n */\n declare\n col_names text[] = coalesce(\n array_agg(c.column_name order by c.ordinal_position),\n '{}'::text[]\n )\n from\n information_schema.columns c\n where\n format('%I.%I', c.table_schema, c.table_name)::regclass = new.entity\n and pg_catalog.has_column_privilege(\n (new.claims ->> 'role'),\n format('%I.%I', c.table_schema, c.table_name)::regclass,\n c.column_name,\n 'SELECT'\n );\n filter realtime.user_defined_filter;\n col_type regtype;\n\n in_val jsonb;\n begin\n for filter in select * from unnest(new.filters) loop\n -- Filtered column is valid\n if not filter.column_name = any(col_names) then\n raise exception 'invalid column for filter %', filter.column_name;\n end if;\n\n -- Type is sanitized and safe for string interpolation\n col_type = (\n select atttypid::regtype\n from pg_catalog.pg_attribute\n where attrelid = new.entity\n and attname = filter.column_name\n );\n if col_type is null then\n raise exception 'failed to lookup type for column %', filter.column_name;\n end if;\n\n -- Set maximum number of entries for in filter\n if filter.op = 'in'::realtime.equality_op then\n in_val = realtime.cast(filter.value, (col_type::text || '[]')::regtype);\n if coalesce(jsonb_array_length(in_val), 0) > 100 then\n raise exception 'too many values for in filter. Maximum 100';\n end if;\n else\n -- raises an exception if value is not coercable to type\n perform realtime.cast(filter.value, col_type);\n end if;\n\n end loop;\n\n -- Apply consistent order to filters so the unique constraint on\n -- (subscription_id, entity, filters) can't be tricked by a different filter order\n new.filters = coalesce(\n array_agg(f order by f.column_name, f.op, f.value),\n '{}'\n ) from unnest(new.filters) f;\n\n return new;\n end;\n $function$\n", "volatility": "VOLATILE", "return_type": "trigger", "returns_set": false, "security_definer": false, "identity_arguments": "" }, { "cost": 100, "name": "topic", "rows": 0, "schema": "realtime", "strict": false, "comment": null, "language": "sql", "parallel": "UNSAFE", "arguments": "", "definition": "CREATE OR REPLACE FUNCTION realtime.topic()\n RETURNS text\n LANGUAGE sql\n STABLE\nAS $function$\nselect nullif(current_setting('realtime.topic', true), '')::text;\n$function$\n", "volatility": "STABLE", "return_type": "text", "returns_set": false, "security_definer": false, "identity_arguments": "" }, { "cost": 100, "name": "mark_stale_products_inactive", "rows": 0, "schema": "public", "strict": false, "comment": null, "language": "plpgsql", "parallel": "UNSAFE", "arguments": "", "definition": "CREATE OR REPLACE FUNCTION public.mark_stale_products_inactive()\n RETURNS void\n LANGUAGE plpgsql\nAS $function$\nBEGIN\n UPDATE supplier_products\n SET is_active = false\n WHERE last_scraped_at < now() - INTERVAL '30 days'\n AND is_active = true;\nEND;\n$function$\n", "volatility": "VOLATILE", "return_type": "void", "returns_set": false, "security_definer": false, "identity_arguments": "" }, { "cost": 100, "name": "send", "rows": 0, "schema": "realtime", "strict": false, "comment": null, "language": "plpgsql", "parallel": "UNSAFE", "arguments": "payload jsonb, event text, topic text, private boolean DEFAULT true", "definition": "CREATE OR REPLACE FUNCTION realtime.send(payload jsonb, event text, topic text, private boolean DEFAULT true)\n RETURNS void\n LANGUAGE plpgsql\nAS $function$\nBEGIN\n BEGIN\n -- Set the topic configuration\n EXECUTE format('SET LOCAL realtime.topic TO %L', topic);\n\n -- Attempt to insert the message\n INSERT INTO realtime.messages (payload, event, topic, private, extension)\n VALUES (payload, event, topic, private, 'broadcast');\n EXCEPTION\n WHEN OTHERS THEN\n -- Capture and notify the error\n RAISE WARNING 'ErrorSendingBroadcastMessage: %', SQLERRM;\n END;\nEND;\n$function$\n", "volatility": "VOLATILE", "return_type": "void", "returns_set": false, "security_definer": false, "identity_arguments": "payload jsonb, event text, topic text, private boolean" }, { "cost": 100, "name": "update_updated_at_column", "rows": 0, "schema": "public", "strict": false, "comment": null, "language": "plpgsql", "parallel": "UNSAFE", "arguments": "", "definition": "CREATE OR REPLACE FUNCTION public.update_updated_at_column()\n RETURNS trigger\n LANGUAGE plpgsql\nAS $function$\nBEGIN\n NEW.updated_at = now();\n RETURN NEW;\nEND;\n$function$\n", "volatility": "VOLATILE", "return_type": "trigger", "returns_set": false, "security_definer": false, "identity_arguments": "" }, { "cost": 100, "name": "update_next_generation_date", "rows": 0, "schema": "public", "strict": false, "comment": null, "language": "plpgsql", "parallel": "UNSAFE", "arguments": "", "definition": "CREATE OR REPLACE FUNCTION public.update_next_generation_date()\n RETURNS trigger\n LANGUAGE plpgsql\nAS $function$\nBEGIN\n NEW.next_generation_date :=\n CASE NEW.frequency\n WHEN 'daily' THEN NEW.start_date + (NEW.interval_count || ' days')::interval\n WHEN 'weekly' THEN NEW.start_date + (NEW.interval_count || ' weeks')::interval\n WHEN 'biweekly' THEN NEW.start_date + (NEW.interval_count * 2 || ' weeks')::interval\n WHEN 'monthly' THEN NEW.start_date + (NEW.interval_count || ' months')::interval\n WHEN 'quarterly' THEN NEW.start_date + (NEW.interval_count * 3 || ' months')::interval\n WHEN 'yearly' THEN NEW.start_date + (NEW.interval_count || ' years')::interval\n END::date;\n RETURN NEW;\nEND;\n$function$\n", "volatility": "VOLATILE", "return_type": "trigger", "returns_set": false, "security_definer": false, "identity_arguments": "" } ], "sequences": [ { "name": "seq_schema_version", "schema": "graphql", "data_type": "integer", "increment": "1", "last_value": 916, "start_value": "1", "cycle_option": "YES", "maximum_value": "2147483647", "minimum_value": "1" } ], "extensions": [ { "name": "plpgsql", "schema": "pg_catalog", "comment": "PL/pgSQL procedural language", "version": "1.0", "relocatable": false }, { "name": "pg_stat_statements", "schema": "extensions", "comment": "track planning and execution statistics of all SQL statements executed", "version": "1.11", "relocatable": true }, { "name": "uuid-ossp", "schema": "extensions", "comment": "generate universally unique identifiers (UUIDs)", "version": "1.1", "relocatable": true }, { "name": "pgcrypto", "schema": "extensions", "comment": "cryptographic functions", "version": "1.3", "relocatable": true }, { "name": "supabase_vault", "schema": "vault", "comment": "Supabase Vault Extension", "version": "0.3.1", "relocatable": false }, { "name": "pg_graphql", "schema": "graphql", "comment": "pg_graphql: GraphQL support", "version": "1.5.11", "relocatable": false } ], "statistics": { "total_enums": 2, "total_views": 2, "total_tables": 27, "total_columns": 399, "total_indexes": 101, "total_policies": 30, "total_triggers": 19, "tables_with_rls": 20, "total_functions": 28, "database_size_mb": 12.21, "tables_without_rls": 4, "total_foreign_keys": 36, "total_materialized_views": 0 }, "audit_version": "2.0", "audit_timestamp": "2025-11-11T00:25:27.740804+00:00", "materialized_views": null } } ]
